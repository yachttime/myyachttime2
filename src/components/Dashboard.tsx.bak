import { useState, useEffect } from 'react';
import { Anchor, Calendar, CheckCircle, AlertCircle, BookOpen, LogOut, Wrench, Send, Play, Shield, ClipboardCheck, Ship, CalendarPlus, FileUp, MessageCircle, Mail, Edit2, Trash2, ChevronLeft, ChevronRight, History } from 'lucide-react';
import { useAuth } from '../contexts/AuthContext';
import { supabase, YachtBooking, MaintenanceRequest, EducationVideo, TripInspection, ConditionRating, InspectionType, RepairRequest, OwnerChatMessage, YachtHistoryLog, logYachtActivity } from '../lib/supabase';

interface DashboardProps {
  onNavigate: (page: 'maintenance' | 'education') => void;
}

export const Dashboard = ({ onNavigate }: DashboardProps) => {
  const { user, userProfile, yacht, signOut } = useAuth();
  const [bookings, setBookings] = useState<YachtBooking[]>([]);
  const [maintenanceRequests, setMaintenanceRequests] = useState<MaintenanceRequest[]>([]);
  const [videos, setVideos] = useState<EducationVideo[]>([]);
  const [loading, setLoading] = useState(true);
  const [activeTab, setActiveTab] = useState<'calendar' | 'maintenance' | 'education' | 'admin'>('calendar');
  const [activeBooking, setActiveBooking] = useState<YachtBooking | null>(null);
  const [selectedVideo, setSelectedVideo] = useState<EducationVideo | null>(null);

  useEffect(() => {
    console.log('User Profile:', userProfile);
    console.log('User Role:', userProfile?.role);
  }, [userProfile]);

  const [maintenanceSubject, setMaintenanceSubject] = useState('');
  const [maintenanceDescription, setMaintenanceDescription] = useState('');
  const [maintenanceLoading, setMaintenanceLoading] = useState(false);
  const [maintenanceSuccess, setMaintenanceSuccess] = useState(false);
  const [maintenanceError, setMaintenanceError] = useState('');

  const [selectedYachtForInspection, setSelectedYachtForInspection] = useState<string>('');
  const [inspectionType, setInspectionType] = useState<InspectionType>('check_in');
  const [selectedMechanicId, setSelectedMechanicId] = useState<string>('');
  const [mechanics, setMechanics] = useState<any[]>([]);
  const [inspectionForm, setInspectionForm] = useState({
    hull_condition: 'good' as ConditionRating,
    hull_notes: '',
    deck_condition: 'good' as ConditionRating,
    deck_notes: '',
    cabin_condition: '' as ConditionRating,
    cabin_notes: '',
    galley_condition: 'good' as ConditionRating,
    galley_notes: '',
    head_condition: 'good' as ConditionRating,
    head_notes: '',
    navigation_equipment: 'good' as ConditionRating,
    navigation_notes: '',
    safety_equipment: 'good' as ConditionRating,
    safety_notes: '',
    engine_condition: 'good' as ConditionRating,
    engine_notes: '',
    fuel_level: 100,
    water_level: 100,
    overall_condition: 'good' as ConditionRating,
    additional_notes: '',
    issues_found: false,
    inverter_system: 'ok' as ConditionRating,
    inverter_notes: '',
    master_bathroom: 'ok' as ConditionRating,
    master_bathroom_notes: '',
    secondary_bathroom: 'ok' as ConditionRating,
    secondary_bathroom_notes: '',
    lower_sinks: 'ok' as ConditionRating,
    lower_sinks_notes: '',
    kitchen_sink: 'ok' as ConditionRating,
    kitchen_sink_notes: '',
    garbage_disposal: 'ok' as ConditionRating,
    garbage_disposal_notes: '',
    stove_top: 'ok' as ConditionRating,
    stove_top_notes: '',
    dishwasher: 'ok' as ConditionRating,
    dishwasher_notes: '',
    trash_compactor: 'ok' as ConditionRating,
    trash_compactor_notes: '',
    volt_fans: 'ok' as ConditionRating,
    volt_fans_notes: '',
    ac_filters: 'ok' as ConditionRating,
    ac_filters_notes: '',
    ac_water_pumps: 'ok' as ConditionRating,
    ac_water_pumps_notes: '',
    water_filters: 'ok' as ConditionRating,
    water_filters_notes: '',
    water_pumps_controls: 'ok' as ConditionRating,
    water_pumps_controls_notes: '',
    upper_deck_bathroom: 'ok' as ConditionRating,
    upper_deck_bathroom_notes: '',
    upper_kitchen_sink: 'ok' as ConditionRating,
    upper_kitchen_sink_notes: '',
    upper_disposal: 'ok' as ConditionRating,
    upper_disposal_notes: '',
    icemaker: 'ok' as ConditionRating,
    icemaker_notes: '',
    upper_stove_top: 'ok' as ConditionRating,
    upper_stove_top_notes: '',
    propane: 'ok' as ConditionRating,
    propane_notes: '',
    windless_port: 'ok' as ConditionRating,
    windless_port_notes: '',
    windless_starboard: 'ok' as ConditionRating,
    windless_starboard_notes: '',
    anchor_lines: 'ok' as ConditionRating,
    anchor_lines_notes: '',
    upper_ac_filter: 'ok' as ConditionRating,
    upper_ac_filter_notes: '',
    port_engine_oil: 'ok' as ConditionRating,
    port_engine_oil_notes: '',
    port_generator_oil: 'ok' as ConditionRating,
    port_generator_oil_notes: '',
    starboard_generator_oil: 'ok' as ConditionRating,
    starboard_generator_oil_notes: '',
    starboard_engine_oil: 'ok' as ConditionRating,
    starboard_engine_oil_notes: '',
    sea_strainers: 'ok' as ConditionRating,
    sea_strainers_notes: '',
    engine_batteries: 'ok' as ConditionRating,
    engine_batteries_notes: '',
  });
  const [inspectionLoading, setInspectionLoading] = useState(false);
  const [inspectionSuccess, setInspectionSuccess] = useState(false);
  const [inspectionError, setInspectionError] = useState('');
  const [adminView, setAdminView] = useState<'menu' | 'inspection' | 'yachts' | 'ownertrips' | 'repairs' | 'ownerchat' | 'messages' | 'mastercalendar'>('menu');
  const [allYachts, setAllYachts] = useState<any[]>([]);
  const [yachtForm, setYachtForm] = useState({
    name: '',
    hull_number: '',
    manufacturer: '',
    year: '',
    size: '',
    port_engine: '',
    starboard_engine: '',
    port_generator: '',
    starboard_generator: ''
  });
  const [yachtLoading, setYachtLoading] = useState(false);
  const [yachtSuccess, setYachtSuccess] = useState(false);
  const [yachtError, setYachtError] = useState('');
  const [showYachtForm, setShowYachtForm] = useState(false);
  const [showOwnerTripForm, setShowOwnerTripForm] = useState(false);
  const [ownerTripForm, setOwnerTripForm] = useState({
    owner_name: '',
    owner_contact: '',
    start_date: '',
    departure_time: '',
    end_date: '',
    arrival_time: ''
  });
  const [ownerTripLoading, setOwnerTripLoading] = useState(false);
  const [ownerTripSuccess, setOwnerTripSuccess] = useState(false);
  const [ownerTripError, setOwnerTripError] = useState('');
  const [allUsers, setAllUsers] = useState<any[]>([]);
  const [showRepairForm, setShowRepairForm] = useState(false);
  const [repairForm, setRepairForm] = useState({
    yacht_id: '',
    title: '',
    description: '',
    file: null as File | null
  });
  const [repairLoading, setRepairLoading] = useState(false);
  const [repairSuccess, setRepairSuccess] = useState(false);
  const [repairError, setRepairError] = useState('');
  const [repairRequests, setRepairRequests] = useState<RepairRequest[]>([]);
  const [chatMessages, setChatMessages] = useState<OwnerChatMessage[]>([]);
  const [adminNotifications, setAdminNotifications] = useState<any[]>([]);
  const [newMessage, setNewMessage] = useState('');
  const [chatLoading, setChatLoading] = useState(false);
  const [masterCalendarBookings, setMasterCalendarBookings] = useState<any[]>([]);
  const [calendarView, setCalendarView] = useState<'day' | 'week' | 'month'>('month');
  const [currentDate, setCurrentDate] = useState(new Date());
  const [editingBooking, setEditingBooking] = useState<any | null>(null);
  const [editBookingForm, setEditBookingForm] = useState({
    owner_name: '',
    owner_contact: '',
    start_date: '',
    departure_time: '',
    end_date: '',
    arrival_time: ''
  });
  const [editBookingLoading, setEditBookingLoading] = useState(false);
  const [editBookingError, setEditBookingError] = useState('');
  const [yachtHistoryLogs, setYachtHistoryLogs] = useState<Record<string, YachtHistoryLog[]>>({});
  const [expandedYachtId, setExpandedYachtId] = useState<string | null>(null);

  useEffect(() => {
    loadBookings();
    loadMaintenanceRequests();
    loadVideos();
    loadUsers();
    loadRepairRequests();
    loadChatMessages();
    loadAdminNotifications();
    loadMasterCalendar();
    loadAllYachts();
    loadMechanics();
  }, [user, yacht]);

  const loadBookings = async () => {
    if (!user || !yacht) {
      setLoading(false);
      return;
    }

    try {
      const { data, error } = await supabase
        .from('yacht_bookings')
        .select('*')
        .eq('yacht_id', yacht.id)
        .order('start_date', { ascending: false });

      if (error) throw error;
      setBookings(data || []);

      const current = data?.find(booking => {
        const now = new Date();
        const start = new Date(booking.start_date);
        const end = new Date(booking.end_date);
        return now >= start && now <= end && booking.user_id === user.id;
      });
      setActiveBooking(current || null);
    } catch (error) {
      console.error('Error loading bookings:', error);
    } finally {
      setLoading(false);
    }
  };

  const loadMaintenanceRequests = async () => {
    if (!user || !yacht) return;

    try {
      const { data, error } = await supabase
        .from('maintenance_requests')
        .select('*')
        .eq('yacht_id', yacht.id)
        .order('created_at', { ascending: false });

      if (error) throw error;
      setMaintenanceRequests(data || []);
    } catch (error) {
      console.error('Error loading maintenance requests:', error);
    }
  };

  const loadVideos = async () => {
    try {
      const { data, error } = await supabase
        .from('education_videos')
        .select('*')
        .order('order_index', { ascending: true });

      if (error) throw error;
      setVideos(data || []);
    } catch (error) {
      console.error('Error loading videos:', error);
    }
  };

  const loadUsers = async () => {
    try {
      const { data, error } = await supabase
        .from('user_profiles')
        .select('id, user_id, first_name, last_name, phone')
        .order('first_name', { ascending: true });

      if (error) throw error;
      setAllUsers(data || []);
    } catch (error) {
      console.error('Error loading users:', error);
    }
  };

  const loadAllYachts = async () => {
    try {
      const { data, error } = await supabase
        .from('yachts')
        .select('*')
        .order('name', { ascending: true });

      if (error) throw error;
      setAllYachts(data || []);
    } catch (error) {
      console.error('Error loading yachts:', error);
    }
  };

  const loadMechanics = async () => {
    try {
      const { data, error } = await supabase
        .from('user_profiles')
        .select('id, user_id, first_name, last_name, email, role')
        .in('role', ['mechanic', 'staff'])
        .order('first_name', { ascending: true });

      if (error) throw error;
      setMechanics(data || []);
    } catch (error) {
      console.error('Error loading mechanics:', error);
    }
  };

  const loadYachtHistory = async (yachtId: string) => {
    try {
      const { data, error } = await supabase
        .from('yacht_history_logs')
        .select('*')
        .eq('yacht_id', yachtId)
        .order('created_at', { ascending: false });

      if (error) throw error;
      setYachtHistoryLogs(prev => ({ ...prev, [yachtId]: data || [] }));
    } catch (error) {
      console.error('Error loading yacht history:', error);
    }
  };

  const toggleYachtHistory = async (yachtId: string) => {
    if (expandedYachtId === yachtId) {
      setExpandedYachtId(null);
    } else {
      setExpandedYachtId(yachtId);
      if (!yachtHistoryLogs[yachtId]) {
        await loadYachtHistory(yachtId);
      }
    }
  };

  const loadRepairRequests = async () => {
    try {
      if (!user) return;

      const { data, error } = await supabase
        .from('repair_requests')
        .select(`
          *,
          yachts:yacht_id (name),
          submitter:submitted_by (email),
          approver:approved_by (email)
        `)
        .order('created_at', { ascending: false });

      if (error) throw error;
      setRepairRequests(data || []);
    } catch (error) {
      console.error('Error loading repair requests:', error);
    }
  };

  const handleRepairApproval = async (requestId: string, status: 'approved' | 'rejected', notes?: string) => {
    try {
      const { error } = await supabase
        .from('repair_requests')
        .update({
          status,
          approved_by: user?.id,
          approval_notes: notes || null,
          updated_at: new Date().toISOString()
        })
        .eq('id', requestId);

      if (error) throw error;
      await loadRepairRequests();
    } catch (error) {
      console.error('Error updating repair request:', error);
    }
  };

  const loadChatMessages = async () => {
    try {
      if (!user) return;

      // Load owner chat messages (only for owner chat feature)
      const { data: messagesData, error: messagesError } = await supabase
        .from('owner_chat_messages')
        .select('*')
        .order('created_at', { ascending: false });

      if (messagesError) {
        console.error('Error loading chat messages:', messagesError);
        throw messagesError;
      }

      console.log('Loaded chat messages:', messagesData?.length || 0, 'messages');

      // Then, enrich with user and yacht data
      if (messagesData && messagesData.length > 0) {
        const enrichedMessages = await Promise.all(
          messagesData.map(async (msg) => {
            // Get user profile
            const { data: profileData } = await supabase
              .from('user_profiles')
              .select('first_name, last_name')
              .eq('user_id', msg.user_id)
              .single();

            // Get yacht name
            const { data: yachtData } = await supabase
              .from('yachts')
              .select('name')
              .eq('id', msg.yacht_id)
              .single();

            return {
              ...msg,
              user_profiles: profileData,
              yachts: yachtData
            };
          })
        );

        setChatMessages(enrichedMessages);
      } else {
        setChatMessages([]);
      }
    } catch (error) {
      console.error('Error loading chat messages:', error);
    }
  };

  const loadAdminNotifications = async () => {
    try {
      if (!user) return;

      // Load admin notifications (check-in/check-out alerts) from new table
      const { data: notificationsData, error: notificationsError } = await supabase
        .from('admin_notifications')
        .select('*')
        .order('created_at', { ascending: false });

      if (notificationsError) {
        console.error('Error loading admin notifications:', notificationsError);
        throw notificationsError;
      }

      // Also load legacy check-in/check-out messages from owner_chat_messages for backwards compatibility
      const { data: legacyMessages, error: legacyError } = await supabase
        .from('owner_chat_messages')
        .select('*')
        .or('message.ilike.%Check-In Alert:%,message.ilike.%Check-Out Alert:%')
        .order('created_at', { ascending: false });

      if (legacyError) {
        console.error('Error loading legacy messages:', legacyError);
      }

      console.log('Loaded admin notifications:', notificationsData?.length || 0, 'notifications');
      console.log('Loaded legacy check-in/out messages:', legacyMessages?.length || 0, 'messages');

      // Combine both sources
      const allNotifications = [
        ...(notificationsData || []),
        ...(legacyMessages || [])
      ].sort((a, b) => new Date(b.created_at).getTime() - new Date(a.created_at).getTime());

      // Enrich with user and yacht data
      if (allNotifications && allNotifications.length > 0) {
        const enrichedNotifications = await Promise.all(
          allNotifications.map(async (notif) => {
            // Get user profile
            const { data: profileData } = await supabase
              .from('user_profiles')
              .select('first_name, last_name')
              .eq('user_id', notif.user_id)
              .maybeSingle();

            // Get yacht name
            const { data: yachtData } = await supabase
              .from('yachts')
              .select('name')
              .eq('id', notif.yacht_id)
              .maybeSingle();

            return {
              ...notif,
              user_profiles: profileData,
              yachts: yachtData
            };
          })
        );

        setAdminNotifications(enrichedNotifications);
      } else {
        setAdminNotifications([]);
      }
    } catch (error) {
      console.error('Error loading admin notifications:', error);
    }
  };

  const loadMasterCalendar = async () => {
    try {
      if (!user) {
        console.log('Master Calendar: No user, skipping load');
        return;
      }

      console.log('Master Calendar: Loading bookings...');
      const { data, error } = await supabase
        .from('yacht_bookings')
        .select(`
          *,
          yachts:yacht_id (name)
        `)
        .order('start_date', { ascending: false });

      if (error) {
        console.error('Master Calendar Error:', error);
        throw error;
      }

      console.log('Master Calendar loaded:', data?.length || 0, 'bookings');
      console.log('Master Calendar data:', data);
      setMasterCalendarBookings(data || []);
    } catch (error) {
      console.error('Error loading master calendar:', error);
    }
  };

  const sendChatMessage = async () => {
    if (!newMessage.trim() || !user || !yacht) return;

    setChatLoading(true);
    try {
      const { error } = await supabase
        .from('owner_chat_messages')
        .insert({
          yacht_id: yacht.id,
          user_id: user.id,
          message: newMessage.trim()
        });

      if (error) throw error;

      const userName = userProfile?.first_name && userProfile?.last_name
        ? `${userProfile.first_name} ${userProfile.last_name}`
        : userProfile?.email || user.email || 'Unknown';

      await logYachtActivity(
        yacht.id,
        yacht.name,
        `New message from ${userName}`,
        user.id,
        userName
      );

      setNewMessage('');
      await loadChatMessages();
    } catch (error) {
      console.error('Error sending message:', error);
    } finally {
      setChatLoading(false);
    }
  };

  const handleCheckIn = async () => {
    if (!activeBooking || !user || !yacht) return;

    try {
      const { error } = await supabase
        .from('yacht_bookings')
        .update({ checked_in: true })
        .eq('id', activeBooking.id);

      if (error) throw error;

      const userName = userProfile?.first_name && userProfile?.last_name
        ? `${userProfile.first_name} ${userProfile.last_name}`
        : user.email;

      const now = new Date();
      const checkInMessage = `Check-In Alert: ${userName} checked in to ${yacht.name} on ${now.toLocaleDateString()} at ${now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}`;

      const { error: msgError } = await supabase
        .from('admin_notifications')
        .insert({
          yacht_id: yacht.id,
          user_id: user.id,
          message: checkInMessage,
          notification_type: 'check_in'
        });

      if (msgError) {
        console.error('Error inserting check-in notification:', msgError);
        alert('Warning: Check-in recorded but notification failed to send. Please refresh the page.');
      }

      await logYachtActivity(
        yacht.id,
        yacht.name,
        `${userName} checked in at ${now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}`,
        user.id,
        userName
      );

      await loadBookings();
      await loadAdminNotifications();
    } catch (error) {
      console.error('Error checking in:', error);
    }
  };

  const handleCheckOut = async () => {
    if (!activeBooking || !user || !yacht) return;

    try {
      const { error } = await supabase
        .from('yacht_bookings')
        .update({ checked_out: true })
        .eq('id', activeBooking.id);

      if (error) throw error;

      const userName = userProfile?.first_name && userProfile?.last_name
        ? `${userProfile.first_name} ${userProfile.last_name}`
        : user.email;

      const now = new Date();
      const checkOutMessage = `Check-Out Alert: ${userName} checked out from ${yacht.name} on ${now.toLocaleDateString()} at ${now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}`;

      const { error: msgError } = await supabase
        .from('admin_notifications')
        .insert({
          yacht_id: yacht.id,
          user_id: user.id,
          message: checkOutMessage,
          notification_type: 'check_out'
        });

      if (msgError) {
        console.error('Error inserting check-out notification:', msgError);
        alert('Warning: Check-out recorded but notification failed to send. Please refresh the page.');
      }

      await logYachtActivity(
        yacht.id,
        yacht.name,
        `${userName} checked out at ${now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}`,
        user.id,
        userName
      );

      await loadBookings();
      await loadAdminNotifications();
    } catch (error) {
      console.error('Error checking out:', error);
    }
  };

  const handleMaintenanceSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    if (!user || !yacht) return;

    setMaintenanceLoading(true);
    setMaintenanceError('');
    setMaintenanceSuccess(false);

    try {
      const { error: dbError } = await supabase.from('maintenance_requests').insert({
        user_id: user.id,
        yacht_id: yacht.id,
        subject: maintenanceSubject,
        description: maintenanceDescription,
        priority: 'medium',
        status: 'pending',
      });

      if (dbError) throw dbError;

      const userName = userProfile?.first_name && userProfile?.last_name
        ? `${userProfile.first_name} ${userProfile.last_name}`
        : userProfile?.email || user.email || 'Unknown';

      const maintenanceMessage = `Maintenance Request: ${maintenanceSubject}\n\n${maintenanceDescription}`;

      const { error: notifError } = await supabase
        .from('admin_notifications')
        .insert({
          yacht_id: yacht.id,
          user_id: user.id,
          message: maintenanceMessage,
          notification_type: 'maintenance_request'
        });

      if (notifError) {
        console.error('Error creating admin notification:', notifError);
      }

      await logYachtActivity(
        yacht.id,
        yacht.name,
        `Maintenance request submitted: "${maintenanceSubject}"`,
        user.id,
        userName
      );

      setMaintenanceSuccess(true);
      setMaintenanceSubject('');
      setMaintenanceDescription('');
      await loadMaintenanceRequests();
      await loadAdminNotifications();

      setTimeout(() => {
        setMaintenanceSuccess(false);
      }, 3000);
    } catch (err: any) {
      setMaintenanceError(err.message || 'Failed to submit request');
    } finally {
      setMaintenanceLoading(false);
    }
  };

  const handleInspectionSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    if (!user || !selectedYachtForInspection || !selectedMechanicId) return;

    setInspectionLoading(true);
    setInspectionError('');
    setInspectionSuccess(false);

    try {
      const { error: dbError } = await supabase.from('trip_inspections').insert({
        booking_id: null,
        yacht_id: selectedYachtForInspection,
        inspector_id: selectedMechanicId,
        inspection_type: inspectionType,
        ...inspectionForm,
      });

      if (dbError) throw dbError;

      const selectedYacht = allYachts.find(y => y.id === selectedYachtForInspection);
      const selectedMechanic = mechanics.find(m => m.user_id === selectedMechanicId);
      if (selectedYacht) {
        const mechanicName = selectedMechanic?.first_name && selectedMechanic?.last_name
          ? `${selectedMechanic.first_name} ${selectedMechanic.last_name}`
          : 'Unknown';
        await logYachtActivity(
          selectedYacht.id,
          selectedYacht.name,
          `Post trip inspection completed by ${mechanicName}`,
          user?.id,
          mechanicName
        );
      }

      setInspectionSuccess(true);
      setSelectedYachtForInspection('');
      setSelectedMechanicId('');
      setInspectionForm({
        hull_condition: 'good',
        hull_notes: '',
        deck_condition: 'good',
        deck_notes: '',
        cabin_condition: 'good',
        cabin_notes: '',
        galley_condition: 'good',
        galley_notes: '',
        head_condition: 'good',
        head_notes: '',
        navigation_equipment: 'good',
        navigation_notes: '',
        safety_equipment: 'good',
        safety_notes: '',
        engine_condition: 'good',
        engine_notes: '',
        fuel_level: 100,
        water_level: 100,
        overall_condition: 'good',
        additional_notes: '',
        issues_found: false,
      });

      setTimeout(() => {
        setInspectionSuccess(false);
        setAdminView('menu');
      }, 2000);
    } catch (err: any) {
      setInspectionError(err.message || 'Failed to submit inspection');
    } finally {
      setInspectionLoading(false);
    }
  };

  const formatDate = (dateString: string) => {
    const date = new Date(dateString);
    return date.toLocaleDateString('en-US', {
      weekday: 'short',
      month: 'short',
      day: 'numeric',
    });
  };

  const formatTime = (dateString: string) => {
    const date = new Date(dateString);
    return date.toLocaleTimeString('en-US', {
      hour: 'numeric',
      minute: '2-digit',
      hour12: true,
    });
  };

  const getStatusColor = (status: string) => {
    switch (status) {
      case 'completed': return 'text-green-400';
      case 'in_progress': return 'text-blue-400';
      case 'cancelled': return 'text-slate-500';
      default: return 'text-amber-400';
    }
  };

  const getPriorityColor = (priority: string) => {
    switch (priority) {
      case 'urgent': return 'text-red-400';
      case 'high': return 'text-orange-400';
      case 'medium': return 'text-amber-400';
      default: return 'text-slate-400';
    }
  };

  const handleEditBooking = (booking: any) => {
    setEditingBooking(booking);
    const startDate = new Date(booking.start_date);
    const endDate = new Date(booking.end_date);

    setEditBookingForm({
      owner_name: booking.owner_name || '',
      owner_contact: booking.owner_contact || '',
      start_date: startDate.toISOString().slice(0, 10),
      departure_time: startDate.toTimeString().slice(0, 5),
      end_date: endDate.toISOString().slice(0, 10),
      arrival_time: endDate.toTimeString().slice(0, 5)
    });
  };

  const handleUpdateBooking = async (e: React.FormEvent) => {
    e.preventDefault();
    if (!editingBooking) return;

    setEditBookingLoading(true);
    setEditBookingError('');

    try {
      const startDateTime = new Date(`${editBookingForm.start_date}T${editBookingForm.departure_time}:00`);
      const endDateTime = new Date(`${editBookingForm.end_date}T${editBookingForm.arrival_time}:00`);

      const { error } = await supabase
        .from('yacht_bookings')
        .update({
          owner_name: editBookingForm.owner_name,
          owner_contact: editBookingForm.owner_contact,
          start_date: startDateTime.toISOString(),
          end_date: endDateTime.toISOString(),
        })
        .eq('id', editingBooking.id);

      if (error) throw error;

      const yacht = allYachts.find(y => y.id === editingBooking.yacht_id);
      if (yacht) {
        const userName = userProfile?.first_name && userProfile?.last_name
          ? `${userProfile.first_name} ${userProfile.last_name}`
          : userProfile?.email || 'Unknown';
        await logYachtActivity(
          yacht.id,
          yacht.name,
          `Trip updated for ${editBookingForm.owner_name} (${startDateTime.toLocaleDateString()} - ${endDateTime.toLocaleDateString()})`,
          user?.id,
          userName
        );
      }

      setEditingBooking(null);
      await loadMasterCalendar();
    } catch (err: any) {
      setEditBookingError(err.message || 'Failed to update booking');
    } finally {
      setEditBookingLoading(false);
    }
  };

  const handleDeleteBooking = async (bookingId: string) => {
    if (!confirm('Are you sure you want to delete this trip? This action cannot be undone.')) {
      return;
    }

    try {
      const bookingToDelete = masterCalendarBookings.find(b => b.id === bookingId);

      const { error } = await supabase
        .from('yacht_bookings')
        .delete()
        .eq('id', bookingId);

      if (error) throw error;

      if (bookingToDelete) {
        const yacht = allYachts.find(y => y.id === bookingToDelete.yacht_id);
        if (yacht) {
          const userName = userProfile?.first_name && userProfile?.last_name
            ? `${userProfile.first_name} ${userProfile.last_name}`
            : userProfile?.email || 'Unknown';
          await logYachtActivity(
            yacht.id,
            yacht.name,
            `Trip deleted for ${bookingToDelete.owner_name}`,
            user?.id,
            userName
          );
        }
      }

      await loadMasterCalendar();
    } catch (err: any) {
      console.error('Error deleting booking:', err);
      alert('Failed to delete booking: ' + (err.message || 'Unknown error'));
    }
  };

  const defaultVideos = [
    {
      id: '1',
      title: 'Navigation Systems Overview',
      description: 'Learn about your yacht\'s navigation equipment and how to use it effectively.',
      category: 'Navigation',
      thumbnail_url: 'https://images.pexels.com/photos/163236/luxury-yacht-boat-speed-water-163236.jpeg?auto=compress&cs=tinysrgb&w=400',
      video_url: '#',
      order_index: 0,
      created_at: new Date().toISOString(),
      updated_at: new Date().toISOString(),
    },
    {
      id: '2',
      title: 'Engine Maintenance Basics',
      description: 'Essential information about maintaining your yacht\'s engine systems.',
      category: 'Maintenance',
      thumbnail_url: 'https://images.pexels.com/photos/1838640/pexels-photo-1838640.jpeg?auto=compress&cs=tinysrgb&w=400',
      video_url: '#',
      order_index: 1,
      created_at: new Date().toISOString(),
      updated_at: new Date().toISOString(),
    },
    {
      id: '3',
      title: 'Safety Equipment Guide',
      description: 'Location and proper use of all safety equipment on board.',
      category: 'Safety',
      thumbnail_url: 'https://images.pexels.com/photos/1509582/pexels-photo-1509582.jpeg?auto=compress&cs=tinysrgb&w=400',
      video_url: '#',
      order_index: 2,
      created_at: new Date().toISOString(),
      updated_at: new Date().toISOString(),
    },
  ];

  const displayVideos = videos.length > 0 ? videos : defaultVideos;

  const getDaysInMonth = (date: Date) => {
    const year = date.getFullYear();
    const month = date.getMonth();
    const firstDay = new Date(year, month, 1);
    const lastDay = new Date(year, month + 1, 0);
    const daysInMonth = lastDay.getDate();
    const startingDayOfWeek = firstDay.getDay();

    return { daysInMonth, startingDayOfWeek, firstDay, lastDay };
  };

  const getWeekDays = (date: Date) => {
    const dayOfWeek = date.getDay();
    const weekStart = new Date(date);
    weekStart.setDate(date.getDate() - dayOfWeek);

    const days = [];
    for (let i = 0; i < 7; i++) {
      const day = new Date(weekStart);
      day.setDate(weekStart.getDate() + i);
      days.push(day);
    }
    return days;
  };

  const getBookingsForDate = (date: Date) => {
    const dateStr = date.toDateString();
    return masterCalendarBookings.filter(booking => {
      const startDate = new Date(booking.start_date);
      const endDate = new Date(booking.end_date);
      const checkDate = new Date(date);
      checkDate.setHours(0, 0, 0, 0);
      startDate.setHours(0, 0, 0, 0);
      endDate.setHours(0, 0, 0, 0);

      return checkDate.getTime() === startDate.getTime() || checkDate.getTime() === endDate.getTime();
    });
  };

  const navigateCalendar = (direction: 'prev' | 'next') => {
    const newDate = new Date(currentDate);
    if (calendarView === 'day') {
      newDate.setDate(currentDate.getDate() + (direction === 'next' ? 1 : -1));
    } else if (calendarView === 'week') {
      newDate.setDate(currentDate.getDate() + (direction === 'next' ? 7 : -7));
    } else {
      newDate.setMonth(currentDate.getMonth() + (direction === 'next' ? 1 : -1));
    }
    setCurrentDate(newDate);
  };

  const goToToday = () => {
    setCurrentDate(new Date());
  };

  const formatCalendarTitle = () => {
    if (calendarView === 'day') {
      return currentDate.toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
    } else if (calendarView === 'week') {
      const weekDays = getWeekDays(currentDate);
      const start = weekDays[0];
      const end = weekDays[6];
      return `${start.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })} - ${end.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}`;
    } else {
      return currentDate.toLocaleDateString('en-US', { year: 'numeric', month: 'long' });
    }
  };

  return (
    <div className="min-h-screen bg-gradient-to-b from-slate-900 via-slate-800 to-slate-900 text-white">
      <div className="container mx-auto px-4 py-6">
        <div className="flex items-center gap-3 mb-8">
          <Anchor className="w-7 h-7 text-amber-500" />
          <h1 className="text-xl font-bold tracking-wide">YACHT TIME</h1>
        </div>

        <div className="bg-slate-800/50 backdrop-blur-sm rounded-xl border border-slate-700 mb-8">
          <div className="flex items-center">
            <button
              onClick={() => setActiveTab('calendar')}
              className={`flex-1 flex items-center justify-center gap-2 py-4 transition-colors border-b-2 ${
                activeTab === 'calendar'
                  ? 'border-amber-500 text-amber-500'
                  : 'border-transparent text-slate-400 hover:text-white'
              }`}
            >
              <Calendar className="w-5 h-5" />
              <span className="font-medium">Owners Trip</span>
            </button>
            <button
              onClick={() => setActiveTab('maintenance')}
              className={`flex-1 flex items-center justify-center gap-2 py-4 transition-colors border-b-2 ${
                activeTab === 'maintenance'
                  ? 'border-amber-500 text-amber-500'
                  : 'border-transparent text-slate-400 hover:text-white'
              }`}
            >
              <Wrench className="w-5 h-5" />
              <span className="font-medium">Maintenance</span>
            </button>
            <button
              onClick={() => setActiveTab('education')}
              className={`flex-1 flex items-center justify-center gap-2 py-4 transition-colors border-b-2 ${
                activeTab === 'education'
                  ? 'border-amber-500 text-amber-500'
                  : 'border-transparent text-slate-400 hover:text-white'
              }`}
            >
              <BookOpen className="w-5 h-5" />
              <span className="font-medium">Education</span>
            </button>
            {(userProfile?.role === 'admin' || userProfile?.role === 'mechanic' || userProfile?.role === 'staff') && (
              <button
                onClick={() => setActiveTab('admin')}
                className={`flex-1 flex items-center justify-center gap-2 py-4 transition-colors border-b-2 ${
                  activeTab === 'admin'
                    ? 'border-amber-500 text-amber-500'
                    : 'border-transparent text-slate-400 hover:text-white'
                }`}
              >
                <Shield className="w-5 h-5" />
                <span className="font-medium">Admin</span>
              </button>
            )}
          </div>
        </div>

        <div className="flex justify-between items-center mb-6">
          <div className="flex items-center gap-3">
            <Shield className="w-5 h-5 text-amber-500" />
            <div>
              <p className="text-sm text-slate-400">Current User</p>
              <p className="font-medium">{user?.email}</p>
              <p className="text-xs text-slate-500 capitalize">{userProfile?.role || 'User'}</p>
              {yacht && <p className="text-xs text-amber-500 mt-1">{yacht.name}</p>}
            </div>
          </div>
          <button
            onClick={signOut}
            className="flex items-center gap-2 px-4 py-2 text-slate-400 hover:text-red-400 transition-colors"
          >
            <LogOut className="w-4 h-4" />
            <span>Sign Out</span>
          </button>
        </div>

        <div className="max-w-4xl mx-auto">
          {activeTab === 'calendar' && (
            <div className="space-y-6">
              <div className="bg-slate-800/50 backdrop-blur-sm rounded-2xl p-6 border border-slate-700">
                <div className="flex items-center gap-2 mb-4">
                  <Calendar className="w-5 h-5 text-amber-500" />
                  <h2 className="text-lg font-semibold">
                    {yacht?.name || 'Your Yacht'}
                  </h2>
                </div>

                {loading ? (
                  <p className="text-slate-400">Loading booking information...</p>
                ) : activeBooking ? (
                  <div className="space-y-4">
                    <div>
                      <div className="mb-3">
                        <p className="text-sm text-slate-400 mb-1">Trip Departure</p>
                        <div className="text-2xl font-bold">
                          {formatDate(activeBooking.start_date)}
                        </div>
                        <div className="text-xl text-slate-300">
                          {formatTime(activeBooking.start_date)}
                        </div>
                      </div>
                      <div>
                        <p className="text-sm text-slate-400 mb-1">Trip Arrival</p>
                        <div className="text-2xl font-bold">
                          {formatDate(activeBooking.end_date)}
                        </div>
                        <div className="text-xl text-slate-300">
                          {formatTime(activeBooking.end_date)}
                        </div>
                      </div>
                    </div>

                    <div className="space-y-3 pt-4">
                      <button
                        onClick={handleCheckIn}
                        disabled={activeBooking.checked_in}
                        className="w-full bg-slate-700 hover:bg-slate-600 text-white font-semibold py-3 rounded-lg transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"
                      >
                        {activeBooking.checked_in ? (
                          <>
                            <CheckCircle className="w-5 h-5 text-green-400" />
                            Checked In
                          </>
                        ) : (
                          'Check In'
                        )}
                      </button>

                      <button
                        onClick={handleCheckOut}
                        disabled={activeBooking.checked_out || !activeBooking.checked_in}
                        className="w-full bg-slate-700 hover:bg-slate-600 text-white font-semibold py-3 rounded-lg transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"
                      >
                        {activeBooking.checked_out ? (
                          <>
                            <CheckCircle className="w-5 h-5 text-green-400" />
                            Checked Out
                          </>
                        ) : (
                          'Check Off Departure'
                        )}
                      </button>

                      {!activeBooking.checked_out && (
                        <button
                          onClick={() => setActiveTab('maintenance')}
                          className="w-full bg-amber-500 hover:bg-amber-600 text-slate-900 font-semibold py-3 rounded-lg transition-all duration-300"
                        >
                          Make Maintenance Request
                        </button>
                      )}
                    </div>
                  </div>
                ) : (
                  <div className="text-center py-8">
                    <AlertCircle className="w-12 h-12 text-slate-500 mx-auto mb-3" />
                    <p className="text-slate-400">No active bookings scheduled</p>
                  </div>
                )}
              </div>

              {bookings.length > 0 && (
                <div className="bg-slate-800/50 backdrop-blur-sm rounded-2xl p-6 border border-slate-700">
                  <h3 className="text-lg font-semibold mb-4">Recent Bookings</h3>
                  <div className="space-y-3">
                    {bookings.slice(0, 3).map((booking) => (
                      <div
                        key={booking.id}
                        className="bg-slate-900/50 rounded-lg p-4 border border-slate-700"
                      >
                        <div className="flex justify-between items-center">
                          <div>
                            <div className="font-medium">
                              {formatDate(booking.start_date)} - {formatDate(booking.end_date)}
                            </div>
                            <div className="text-sm text-slate-400 mt-1">
                              {booking.checked_in && 'Checked In'}
                              {booking.checked_out && ' • Checked Out'}
                            </div>
                          </div>
                          {booking.checked_in && booking.checked_out && (
                            <CheckCircle className="w-5 h-5 text-green-400" />
                          )}
                        </div>
                      </div>
                    ))}
                  </div>
                </div>
              )}

              <div className="bg-slate-800/50 backdrop-blur-sm rounded-2xl p-6 border border-slate-700">
                <h3 className="text-lg font-semibold mb-4">Antelope Point</h3>
                <div className="space-y-3">
                  <button
                    onClick={() => window.open('https://share.hsforms.com/1saGMMmyZSRu6bgPwR2YC3Aqgylg', '_blank')}
                    className="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 rounded-lg transition-all duration-300"
                  >
                    Book Trip including Cathedral Cleaning Package
                  </button>
                  <button
                    onClick={() => window.open('https://share.hsforms.com/1wLei4o0HTL6knc738ffwXQqgylg', '_blank')}
                    className="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 rounded-lg transition-all duration-300"
                  >
                    Book Trip & Turnaround without Cleaning Package
                  </button>
                  <button
                    onClick={() => window.open('https://share.hsforms.com/13sFPShojQni7ZaOfBJB5mAqgylg', '_blank')}
                    className="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 rounded-lg transition-all duration-300"
                  >
                    Update your trips deliverables
                  </button>

                  <button
                    onClick={() => window.open('https://beachbagsanchors.com/', '_blank')}
                    className="w-full mt-3 bg-amber-600 hover:bg-amber-700 text-white font-semibold py-3 rounded-lg transition-all duration-300"
                  >
                    Beach Bags Anchors
                  </button>

                  <div className="mt-6 pt-6 border-t border-slate-700">
                    <h4 className="font-semibold text-lg mb-3">Hours of Operation</h4>
                    <p className="text-slate-300 mb-4">Antelope Point Marina runs on Arizona time zone 928-645-5900</p>

                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                      <div>
                        <h5 className="font-semibold text-amber-500 mb-2">On-season – May 6th to Sept. 31st</h5>
                        <div className="space-y-1 text-sm text-slate-300">
                          <p><span className="text-slate-400">APEX office:</span> 8:00am – 6:00pm, 7 days a week</p>
                          <p><span className="text-slate-400">Pilot service:</span> 7:00am – 6:00pm, 7 days a week</p>
                          <p><span className="text-slate-400">Cart Service:</span> 24/7</p>
                          <p><span className="text-slate-400">Valet Launch:</span> 7:00am – 7:00pm, 7 days a week</p>
                        </div>
                      </div>

                      <div>
                        <h5 className="font-semibold text-amber-500 mb-2">Off-season – Oct 1st to May 1st</h5>
                        <div className="space-y-1 text-sm text-slate-300">
                          <p><span className="text-slate-400">APEX office:</span> 9:00am – 4:00pm, M-F</p>
                          <p><span className="text-slate-400">Pilot service:</span> 9:00am – 4:00pm, M-F</p>
                          <p><span className="text-slate-400">Cart Service:</span> 24/7</p>
                          <p><span className="text-slate-400">Valet Launch:</span> 9:00am – 3:00pm, 7 days a week</p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          )}

          {activeTab === 'maintenance' && (
            <div className="space-y-6">
              <div className="bg-slate-800/50 backdrop-blur-sm rounded-2xl p-6 border border-slate-700">
                <div className="mb-4">
                  <p className="text-slate-400">Yacht:</p>
                  <p className="text-lg font-semibold">{yacht?.name || 'No yacht assigned'}</p>
                </div>
                <div>
                  <p className="text-slate-400">Owner Email:</p>
                  <p className="text-lg font-semibold">{user?.email}</p>
                </div>
              </div>

              <form onSubmit={handleMaintenanceSubmit} className="space-y-6">
                <div className="bg-slate-800/50 backdrop-blur-sm rounded-2xl p-6 border border-slate-700">
                  <h3 className="text-xl font-semibold mb-4">New Maintenance Request</h3>
                  <div className="space-y-6">
                    <div>
                      <label htmlFor="subject" className="block text-sm font-medium mb-2">
                        Status
                      </label>
                      <input
                        id="subject"
                        type="text"
                        value={maintenanceSubject}
                        onChange={(e) => setMaintenanceSubject(e.target.value)}
                        placeholder="Dose the Maintenance request need to be completed during your trip or after"
                        className="w-full px-4 py-3 bg-slate-900/50 border border-slate-600 rounded-lg focus:outline-none focus:border-amber-500 transition-colors text-white placeholder-slate-400"
                        required
                      />
                    </div>

                    <div>
                      <label htmlFor="description" className="block text-sm font-medium mb-2">
                        Description
                      </label>
                      <textarea
                        id="description"
                        value={maintenanceDescription}
                        onChange={(e) => setMaintenanceDescription(e.target.value)}
                        placeholder="Provide detailed information about the maintenance request..."
                        rows={8}
                        className="w-full px-4 py-3 bg-slate-900/50 border border-slate-600 rounded-lg focus:outline-none focus:border-amber-500 transition-colors text-white placeholder-slate-400 resize-none"
                        required
                      />
                    </div>
                  </div>
                </div>

                {maintenanceError && (
                  <div className="bg-red-500/10 border border-red-500 text-red-500 px-4 py-3 rounded-lg text-sm">
                    {maintenanceError}
                  </div>
                )}

                {maintenanceSuccess && (
                  <div className="bg-green-500/10 border border-green-500 text-green-500 px-4 py-3 rounded-lg text-sm">
                    Maintenance request submitted successfully!
                  </div>
                )}

                <button
                  type="submit"
                  disabled={maintenanceLoading}
                  className="w-full bg-amber-500 hover:bg-amber-600 text-slate-900 font-semibold py-4 rounded-lg transition-all duration-300 shadow-lg disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"
                >
                  <Send className="w-5 h-5" />
                  {maintenanceLoading ? 'Sending...' : 'Send to Manager'}
                </button>
              </form>

              {maintenanceRequests.length > 0 && (
                <div className="bg-slate-800/50 backdrop-blur-sm rounded-2xl p-6 border border-slate-700">
                  <h3 className="text-lg font-semibold mb-4">Your Requests</h3>
                  <div className="space-y-3">
                    {maintenanceRequests.slice(0, 5).map((request) => (
                      <div
                        key={request.id}
                        className="bg-slate-900/50 rounded-lg p-4 border border-slate-700"
                      >
                        <div className="flex justify-between items-start mb-2">
                          <h4 className="font-medium">{request.subject}</h4>
                          <span className={`text-sm ${getStatusColor(request.status)}`}>
                            {request.status}
                          </span>
                        </div>
                        <p className="text-sm text-slate-400 mb-2 line-clamp-2">{request.description}</p>
                        <div className="flex items-center gap-4 text-xs text-slate-500">
                          <span className={getPriorityColor(request.priority)}>
                            {request.priority} priority
                          </span>
                          <span>{formatDate(request.created_at)}</span>
                        </div>
                      </div>
                    ))}
                  </div>
                </div>
              )}
            </div>
          )}

          {activeTab === 'education' && (
            <div className="space-y-6">
              {selectedVideo ? (
                <>
                  <div className="bg-slate-900 rounded-2xl overflow-hidden shadow-2xl">
                    <div className="aspect-video bg-slate-800 flex items-center justify-center">
                      <div className="text-center">
                        <Play className="w-20 h-20 text-amber-500 mx-auto mb-4" />
                        <p className="text-slate-400">Video player would load here</p>
                      </div>
                    </div>
                  </div>

                  <div className="bg-slate-800/50 backdrop-blur-sm rounded-2xl p-6 border border-slate-700">
                    <div className="inline-block bg-amber-500/20 text-amber-500 px-3 py-1 rounded-full text-sm font-medium mb-4">
                      {selectedVideo.category}
                    </div>
                    <h2 className="text-2xl font-bold mb-3">{selectedVideo.title}</h2>
                    <p className="text-slate-300 leading-relaxed">{selectedVideo.description}</p>
                  </div>

                  <button
                    onClick={() => setSelectedVideo(null)}
                    className="w-full bg-slate-700 hover:bg-slate-600 text-white font-semibold py-3 rounded-lg transition-colors"
                  >
                    Back to Videos
                  </button>
                </>
              ) : (
                <>
                  <h2 className="text-2xl font-bold mb-2">Education</h2>
                  <p className="text-slate-400 mb-6">Learn how things work on your yacht</p>

                  <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                    {displayVideos.map((video) => (
                      <button
                        key={video.id}
                        onClick={() => setSelectedVideo(video)}
                        className="bg-slate-800/50 backdrop-blur-sm rounded-xl overflow-hidden border border-slate-700 hover:border-amber-500 transition-all duration-300 hover:scale-105 text-left"
                      >
                        <div className="relative">
                          <img
                            src={video.thumbnail_url || 'https://images.pexels.com/photos/163236/luxury-yacht-boat-speed-water-163236.jpeg?auto=compress&cs=tinysrgb&w=400'}
                            alt={video.title}
                            className="w-full h-48 object-cover"
                          />
                          <div className="absolute inset-0 bg-gradient-to-t from-slate-900 to-transparent"></div>
                          <div className="absolute inset-0 flex items-center justify-center">
                            <div className="bg-amber-500 rounded-full p-4 shadow-lg hover:scale-110 transition-transform">
                              <Play className="w-8 h-8 text-slate-900" fill="currentColor" />
                            </div>
                          </div>
                        </div>
                        <div className="p-4">
                          <div className="inline-block bg-amber-500/20 text-amber-500 px-2 py-1 rounded text-xs font-medium mb-2">
                            {video.category}
                          </div>
                          <h3 className="font-semibold mb-2 line-clamp-2">{video.title}</h3>
                          <p className="text-sm text-slate-400 line-clamp-2">{video.description}</p>
                        </div>
                      </button>
                    ))}
                  </div>
                </>
              )}
            </div>
          )}

          {activeTab === 'admin' && (
            <div className="space-y-6">
              {adminView === 'menu' ? (
                <>
                  <div className="mb-6">
                    <h2 className="text-2xl font-bold mb-2">Admin Dashboard</h2>
                    <p className="text-slate-400">Manage yacht operations and inspections</p>
                  </div>

                  <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <button
                      onClick={() => setAdminView('inspection')}
                      className="bg-slate-800/50 backdrop-blur-sm rounded-2xl p-6 border border-slate-700 hover:border-amber-500 transition-all duration-300 hover:scale-105 text-left group"
                    >
                      <div className="flex items-center gap-4 mb-4">
                        <div className="bg-amber-500/20 p-4 rounded-xl group-hover:bg-amber-500/30 transition-colors">
                          <ClipboardCheck className="w-8 h-8 text-amber-500" />
                        </div>
                      </div>
                      <h3 className="text-xl font-bold mb-2">Trip Inspection Form</h3>
                      <p className="text-slate-400 text-sm">Complete check-in and check-out inspections for yacht trips</p>
                    </button>

                    <button
                      onClick={() => setAdminView('yachts')}
                      className="bg-slate-800/50 backdrop-blur-sm rounded-2xl p-6 border border-slate-700 hover:border-amber-500 transition-all duration-300 hover:scale-105 text-left group"
                    >
                      <div className="flex items-center gap-4 mb-4">
                        <div className="bg-blue-500/20 p-4 rounded-xl group-hover:bg-blue-500/30 transition-colors">
                          <Ship className="w-8 h-8 text-blue-500" />
                        </div>
                      </div>
                      <h3 className="text-xl font-bold mb-2">Yachts</h3>
                      <p className="text-slate-400 text-sm">Manage yacht fleet and vessel information</p>
                    </button>

                    <button
                      onClick={() => setAdminView('ownertrips')}
                      className="bg-slate-800/50 backdrop-blur-sm rounded-2xl p-6 border border-slate-700 hover:border-amber-500 transition-all duration-300 hover:scale-105 text-left group"
                    >
                      <div className="flex items-center gap-4 mb-4">
                        <div className="bg-green-500/20 p-4 rounded-xl group-hover:bg-green-500/30 transition-colors">
                          <CalendarPlus className="w-8 h-8 text-green-500" />
                        </div>
                      </div>
                      <h3 className="text-xl font-bold mb-2">Owner Trips</h3>
                      <p className="text-slate-400 text-sm">Schedule and manage owner yacht trips</p>
                    </button>

                    <button
                      onClick={() => setAdminView('repairs')}
                      className="bg-slate-800/50 backdrop-blur-sm rounded-2xl p-6 border border-slate-700 hover:border-amber-500 transition-all duration-300 hover:scale-105 text-left group"
                    >
                      <div className="flex items-center gap-4 mb-4">
                        <div className="bg-orange-500/20 p-4 rounded-xl group-hover:bg-orange-500/30 transition-colors">
                          <FileUp className="w-8 h-8 text-orange-500" />
                        </div>
                      </div>
                      <h3 className="text-xl font-bold mb-2">Repair Requests</h3>
                      <p className="text-slate-400 text-sm">Upload files and request repair approvals</p>
                    </button>

                    <button
                      onClick={() => setAdminView('ownerchat')}
                      className="bg-slate-800/50 backdrop-blur-sm rounded-2xl p-6 border border-slate-700 hover:border-amber-500 transition-all duration-300 hover:scale-105 text-left group"
                    >
                      <div className="flex items-center gap-4 mb-4">
                        <div className="bg-purple-500/20 p-4 rounded-xl group-hover:bg-purple-500/30 transition-colors">
                          <MessageCircle className="w-8 h-8 text-purple-500" />
                        </div>
                      </div>
                      <h3 className="text-xl font-bold mb-2">Owner Chat</h3>
                      <p className="text-slate-400 text-sm">Connect and chat with all yacht owners</p>
                    </button>

                    <button
                      onClick={() => setAdminView('messages')}
                      className="bg-slate-800/50 backdrop-blur-sm rounded-2xl p-6 border border-slate-700 hover:border-amber-500 transition-all duration-300 hover:scale-105 text-left group"
                    >
                      <div className="flex items-center gap-4 mb-4">
                        <div className="bg-cyan-500/20 p-4 rounded-xl group-hover:bg-cyan-500/30 transition-colors">
                          <Mail className="w-8 h-8 text-cyan-500" />
                        </div>
                      </div>
                      <h3 className="text-xl font-bold mb-2">New Messages</h3>
                      <p className="text-slate-400 text-sm">View all incoming messages from users</p>
                    </button>

                    <button
                      onClick={() => setAdminView('mastercalendar')}
                      className="bg-slate-800/50 backdrop-blur-sm rounded-2xl p-6 border border-slate-700 hover:border-amber-500 transition-all duration-300 hover:scale-105 text-left group"
                    >
                      <div className="flex items-center gap-4 mb-4">
                        <div className="bg-teal-500/20 p-4 rounded-xl group-hover:bg-teal-500/30 transition-colors">
                          <Calendar className="w-8 h-8 text-teal-500" />
                        </div>
                      </div>
                      <h3 className="text-xl font-bold mb-2">Master Calendar</h3>
                      <p className="text-slate-400 text-sm">View all owner trips across all yachts</p>
                    </button>
                  </div>
                </>
              ) : adminView === 'inspection' ? (
                <>
                  <button
                    onClick={() => setAdminView('menu')}
                    className="flex items-center gap-2 text-slate-400 hover:text-amber-500 transition-colors mb-4"
                  >
                    <span>← Back to Admin Menu</span>
                  </button>

                  <div className="flex items-center gap-3 mb-6">
                    <ClipboardCheck className="w-8 h-8 text-amber-500" />
                    <div>
                      <h2 className="text-2xl font-bold">Trip Inspection Form</h2>
                      <p className="text-slate-400">Post trip inspection form</p>
                    </div>
                  </div>

                  <form onSubmit={handleInspectionSubmit} className="space-y-6">
                <div className="bg-slate-800/50 backdrop-blur-sm rounded-2xl p-6 border border-slate-700">
                  <h3 className="text-xl font-semibold mb-4">Inspection Details</h3>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                      <label htmlFor="yacht" className="block text-sm font-medium mb-2">
                        Select Yacht
                      </label>
                      <select
                        id="yacht"
                        value={selectedYachtForInspection}
                        onChange={(e) => setSelectedYachtForInspection(e.target.value)}
                        className="w-full px-4 py-3 bg-slate-900/50 border border-slate-600 rounded-lg focus:outline-none focus:border-amber-500 transition-colors text-white"
                        required
                      >
                        <option value="">Choose a yacht...</option>
                        {allYachts.map((yacht) => (
                          <option key={yacht.id} value={yacht.id}>
                            {yacht.name}
                          </option>
                        ))}
                      </select>
                    </div>

                    <div>
                      <label htmlFor="mechanic" className="block text-sm font-medium mb-2">
                        Mechanic completing Inspection
                      </label>
                      <select
                        id="mechanic"
                        value={selectedMechanicId}
                        onChange={(e) => setSelectedMechanicId(e.target.value)}
                        className="w-full px-4 py-3 bg-slate-900/50 border border-slate-600 rounded-lg focus:outline-none focus:border-amber-500 transition-colors text-white"
                        required
                      >
                        <option value="">Choose a mechanic...</option>
                        {mechanics.map((mechanic) => (
                          <option key={mechanic.id} value={mechanic.user_id}>
                            {mechanic.first_name} {mechanic.last_name}
                          </option>
                        ))}
                      </select>
                    </div>
                  </div>
                </div>

                <div className="bg-slate-800/50 backdrop-blur-sm rounded-2xl p-6 border border-slate-700">
                  <h3 className="text-lg font-semibold mb-4">Exterior Hull</h3>
                  <div className="space-y-6">
                    <div>
                      <label className="block text-sm font-medium mb-2">Hull Damage</label>
                      <div className="grid grid-cols-2 gap-3 mb-2">
                        <button
                          type="button"
                          onClick={() => setInspectionForm({ ...inspectionForm, hull_condition: 'excellent' })}
                          className={`py-2 px-4 rounded-lg font-medium transition-colors ${
                            inspectionForm.hull_condition === 'excellent'
                              ? 'bg-amber-500 text-slate-900'
                              : 'bg-slate-700 text-slate-300 hover:bg-slate-600'
                          }`}
                        >
                          No new damage
                        </button>
                        <button
                          type="button"
                          onClick={() => setInspectionForm({ ...inspectionForm, hull_condition: 'poor' })}
                          className={`py-2 px-4 rounded-lg font-medium transition-colors ${
                            inspectionForm.hull_condition === 'poor'
                              ? 'bg-amber-500 text-slate-900'
                              : 'bg-slate-700 text-slate-300 hover:bg-slate-600'
                          }`}
                        >
                          New damage
                        </button>
                      </div>
                      <textarea
                        value={inspectionForm.hull_notes}
                        onChange={(e) => setInspectionForm({ ...inspectionForm, hull_notes: e.target.value })}
                        placeholder="Notate new damage here"
                        rows={2}
                        className="w-full px-4 py-3 bg-slate-900/50 border border-slate-600 rounded-lg focus:outline-none focus:border-amber-500 transition-colors text-white placeholder-slate-400 resize-none"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-medium mb-2">Shore Cords</label>
                      <div className="grid grid-cols-2 gap-3 mb-2">
                        <button
                          type="button"
                          onClick={() => setInspectionForm({ ...inspectionForm, deck_condition: 'excellent' })}
                          className={`py-2 px-4 rounded-lg font-medium transition-colors ${
                            inspectionForm.deck_condition === 'excellent'
                              ? 'bg-amber-500 text-slate-900'
                              : 'bg-slate-700 text-slate-300 hover:bg-slate-600'
                          }`}
                        >
                          OK
                        </button>
                        <button
                          type="button"
                          onClick={() => setInspectionForm({ ...inspectionForm, deck_condition: 'poor' })}
                          className={`py-2 px-4 rounded-lg font-medium transition-colors ${
                            inspectionForm.deck_condition === 'poor'
                              ? 'bg-amber-500 text-slate-900'
                              : 'bg-slate-700 text-slate-300 hover:bg-slate-600'
                          }`}
                        >
                          Need repairs
                        </button>
                      </div>
                      <textarea
                        value={inspectionForm.deck_notes}
                        onChange={(e) => setInspectionForm({ ...inspectionForm, deck_notes: e.target.value })}
                        placeholder="Notate repairs need or replacement"
                        rows={2}
                        className="w-full px-4 py-3 bg-slate-900/50 border border-slate-600 rounded-lg focus:outline-none focus:border-amber-500 transition-colors text-white placeholder-slate-400 resize-none"
                      />
                    </div>
                  </div>
                </div>

                <div className="bg-slate-800/50 backdrop-blur-sm rounded-2xl p-6 border border-slate-700">
                  <h3 className="text-lg font-semibold mb-4">Engine Hours</h3>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                      <label className="block text-sm font-medium mb-2">Port Engine Hours</label>
                      <input
                        type="text"
                        value={inspectionForm.cabin_notes}
                        onChange={(e) => setInspectionForm({ ...inspectionForm, cabin_notes: e.target.value })}
                        placeholder="Enter hours"
                        className="w-full px-4 py-3 bg-slate-900/50 border border-slate-600 rounded-lg focus:outline-none focus:border-amber-500 transition-colors text-white placeholder-slate-400"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-medium mb-2">Starboard Engine Hours</label>
                      <input
                        type="text"
                        value={inspectionForm.galley_notes}
                        onChange={(e) => setInspectionForm({ ...inspectionForm, galley_notes: e.target.value })}
                        placeholder="Enter hours"
                        className="w-full px-4 py-3 bg-slate-900/50 border border-slate-600 rounded-lg focus:outline-none focus:border-amber-500 transition-colors text-white placeholder-slate-400"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-medium mb-2">Port Generator Hours</label>
                      <input
                        type="text"
                        value={inspectionForm.head_notes}
                        onChange={(e) => setInspectionForm({ ...inspectionForm, head_notes: e.target.value })}
                        placeholder="Enter hours"
                        className="w-full px-4 py-3 bg-slate-900/50 border border-slate-600 rounded-lg focus:outline-none focus:border-amber-500 transition-colors text-white placeholder-slate-400"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-medium mb-2">Starboard Generator Hours</label>
                      <input
                        type="text"
                        value={inspectionForm.cabin_condition}
                        onChange={(e) => setInspectionForm({ ...inspectionForm, cabin_condition: e.target.value as ConditionRating })}
                        placeholder="Enter hours"
                        className="w-full px-4 py-3 bg-slate-900/50 border border-slate-600 rounded-lg focus:outline-none focus:border-amber-500 transition-colors text-white placeholder-slate-400"
                      />
                    </div>
                  </div>
                </div>

                <div className="bg-slate-800/50 backdrop-blur-sm rounded-2xl p-6 border border-slate-700">
                  <h3 className="text-lg font-semibold mb-4">Main Cabin</h3>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                      <label className="block text-sm font-medium mb-2">Inverter System</label>
                      <div className="grid grid-cols-2 gap-3 mb-2">
                        {['ok', 'needs service'].map((rating) => (
                          <button
                            key={rating}
                            type="button"
                            onClick={() => setInspectionForm({ ...inspectionForm, inverter_system: rating as ConditionRating })}
                            className={`py-2 px-4 rounded-lg font-medium transition-colors ${
                              inspectionForm.inverter_system === rating
                                ? 'bg-amber-500 text-slate-900'
                                : 'bg-slate-700 text-slate-300 hover:bg-slate-600'
                            }`}
                          >
                            {rating.charAt(0).toUpperCase() + rating.slice(1)}
                          </button>
                        ))}
                      </div>
                      <textarea
                        value={inspectionForm.inverter_notes}
                        onChange={(e) => setInspectionForm({ ...inspectionForm, inverter_notes: e.target.value })}
                        placeholder="Document issues..."
                        rows={2}
                        className="w-full px-4 py-3 bg-slate-900/50 border border-slate-600 rounded-lg focus:outline-none focus:border-amber-500 transition-colors text-white placeholder-slate-400 resize-none"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-medium mb-2">Master Bedroom Bathroom</label>
                      <div className="grid grid-cols-2 gap-3 mb-2">
                        {['ok', 'needs service'].map((rating) => (
                          <button
                            key={rating}
                            type="button"
                            onClick={() => setInspectionForm({ ...inspectionForm, master_bathroom: rating as ConditionRating })}
                            className={`py-2 px-4 rounded-lg font-medium transition-colors ${
                              inspectionForm.master_bathroom === rating
                                ? 'bg-amber-500 text-slate-900'
                                : 'bg-slate-700 text-slate-300 hover:bg-slate-600'
                            }`}
                          >
                            {rating.charAt(0).toUpperCase() + rating.slice(1)}
                          </button>
                        ))}
                      </div>
                      <textarea
                        value={inspectionForm.master_bathroom_notes}
                        onChange={(e) => setInspectionForm({ ...inspectionForm, master_bathroom_notes: e.target.value })}
                        placeholder="Document issues..."
                        rows={2}
                        className="w-full px-4 py-3 bg-slate-900/50 border border-slate-600 rounded-lg focus:outline-none focus:border-amber-500 transition-colors text-white placeholder-slate-400 resize-none"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-medium mb-2">Secondary Bathroom</label>
                      <div className="grid grid-cols-2 gap-3 mb-2">
                        {['ok', 'needs service'].map((rating) => (
                          <button
                            key={rating}
                            type="button"
                            onClick={() => setInspectionForm({ ...inspectionForm, secondary_bathroom: rating as ConditionRating })}
                            className={`py-2 px-4 rounded-lg font-medium transition-colors ${
                              inspectionForm.secondary_bathroom === rating
                                ? 'bg-amber-500 text-slate-900'
                                : 'bg-slate-700 text-slate-300 hover:bg-slate-600'
                            }`}
                          >
                            {rating.charAt(0).toUpperCase() + rating.slice(1)}
                          </button>
                        ))}
                      </div>
                      <textarea
                        value={inspectionForm.secondary_bathroom_notes}
                        onChange={(e) => setInspectionForm({ ...inspectionForm, secondary_bathroom_notes: e.target.value })}
                        placeholder="Document issues..."
                        rows={2}
                        className="w-full px-4 py-3 bg-slate-900/50 border border-slate-600 rounded-lg focus:outline-none focus:border-amber-500 transition-colors text-white placeholder-slate-400 resize-none"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-medium mb-2">Lower Sinks</label>
                      <div className="grid grid-cols-2 gap-3 mb-2">
                        {['ok', 'needs service'].map((rating) => (
                          <button
                            key={rating}
                            type="button"
                            onClick={() => setInspectionForm({ ...inspectionForm, lower_sinks: rating as ConditionRating })}
                            className={`py-2 px-4 rounded-lg font-medium transition-colors ${
                              inspectionForm.lower_sinks === rating
                                ? 'bg-amber-500 text-slate-900'
                                : 'bg-slate-700 text-slate-300 hover:bg-slate-600'
                            }`}
                          >
                            {rating.charAt(0).toUpperCase() + rating.slice(1)}
                          </button>
                        ))}
                      </div>
                      <textarea
                        value={inspectionForm.lower_sinks_notes}
                        onChange={(e) => setInspectionForm({ ...inspectionForm, lower_sinks_notes: e.target.value })}
                        placeholder="Document issues..."
                        rows={2}
                        className="w-full px-4 py-3 bg-slate-900/50 border border-slate-600 rounded-lg focus:outline-none focus:border-amber-500 transition-colors text-white placeholder-slate-400 resize-none"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-medium mb-2">Kitchen Sink</label>
                      <div className="grid grid-cols-2 gap-3 mb-2">
                        {['ok', 'needs service'].map((rating) => (
                          <button
                            key={rating}
                            type="button"
                            onClick={() => setInspectionForm({ ...inspectionForm, kitchen_sink: rating as ConditionRating })}
                            className={`py-2 px-4 rounded-lg font-medium transition-colors ${
                              inspectionForm.kitchen_sink === rating
                                ? 'bg-amber-500 text-slate-900'
                                : 'bg-slate-700 text-slate-300 hover:bg-slate-600'
                            }`}
                          >
                            {rating.charAt(0).toUpperCase() + rating.slice(1)}
                          </button>
                        ))}
                      </div>
                      <textarea
                        value={inspectionForm.kitchen_sink_notes}
                        onChange={(e) => setInspectionForm({ ...inspectionForm, kitchen_sink_notes: e.target.value })}
                        placeholder="Document issues..."
                        rows={2}
                        className="w-full px-4 py-3 bg-slate-900/50 border border-slate-600 rounded-lg focus:outline-none focus:border-amber-500 transition-colors text-white placeholder-slate-400 resize-none"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-medium mb-2">Garbage Disposal</label>
                      <div className="grid grid-cols-2 gap-3 mb-2">
                        {['ok', 'needs service'].map((rating) => (
                          <button
                            key={rating}
                            type="button"
                            onClick={() => setInspectionForm({ ...inspectionForm, garbage_disposal: rating as ConditionRating })}
                            className={`py-2 px-4 rounded-lg font-medium transition-colors ${
                              inspectionForm.garbage_disposal === rating
                                ? 'bg-amber-500 text-slate-900'
                                : 'bg-slate-700 text-slate-300 hover:bg-slate-600'
                            }`}
                          >
                            {rating.charAt(0).toUpperCase() + rating.slice(1)}
                          </button>
                        ))}
                      </div>
                      <textarea
                        value={inspectionForm.garbage_disposal_notes}
                        onChange={(e) => setInspectionForm({ ...inspectionForm, garbage_disposal_notes: e.target.value })}
                        placeholder="Document issues..."
                        rows={2}
                        className="w-full px-4 py-3 bg-slate-900/50 border border-slate-600 rounded-lg focus:outline-none focus:border-amber-500 transition-colors text-white placeholder-slate-400 resize-none"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-medium mb-2">Stove Top</label>
                      <div className="grid grid-cols-2 gap-3 mb-2">
                        {['ok', 'needs service'].map((rating) => (
                          <button
                            key={rating}
                            type="button"
                            onClick={() => setInspectionForm({ ...inspectionForm, stove_top: rating as ConditionRating })}
                            className={`py-2 px-4 rounded-lg font-medium transition-colors ${
                              inspectionForm.stove_top === rating
                                ? 'bg-amber-500 text-slate-900'
                                : 'bg-slate-700 text-slate-300 hover:bg-slate-600'
                            }`}
                          >
                            {rating.charAt(0).toUpperCase() + rating.slice(1)}
                          </button>
                        ))}
                      </div>
                      <textarea
                        value={inspectionForm.stove_top_notes}
                        onChange={(e) => setInspectionForm({ ...inspectionForm, stove_top_notes: e.target.value })}
                        placeholder="Document issues..."
                        rows={2}
                        className="w-full px-4 py-3 bg-slate-900/50 border border-slate-600 rounded-lg focus:outline-none focus:border-amber-500 transition-colors text-white placeholder-slate-400 resize-none"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-medium mb-2">Dishwasher</label>
                      <div className="grid grid-cols-2 gap-3 mb-2">
                        {['ok', 'needs service'].map((rating) => (
                          <button
                            key={rating}
                            type="button"
                            onClick={() => setInspectionForm({ ...inspectionForm, dishwasher: rating as ConditionRating })}
                            className={`py-2 px-4 rounded-lg font-medium transition-colors ${
                              inspectionForm.dishwasher === rating
                                ? 'bg-amber-500 text-slate-900'
                                : 'bg-slate-700 text-slate-300 hover:bg-slate-600'
                            }`}
                          >
                            {rating.charAt(0).toUpperCase() + rating.slice(1)}
                          </button>
                        ))}
                      </div>
                      <textarea
                        value={inspectionForm.dishwasher_notes}
                        onChange={(e) => setInspectionForm({ ...inspectionForm, dishwasher_notes: e.target.value })}
                        placeholder="Document issues..."
                        rows={2}
                        className="w-full px-4 py-3 bg-slate-900/50 border border-slate-600 rounded-lg focus:outline-none focus:border-amber-500 transition-colors text-white placeholder-slate-400 resize-none"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-medium mb-2">Trash Compactor</label>
                      <div className="grid grid-cols-2 gap-3 mb-2">
                        {['ok', 'needs service'].map((rating) => (
                          <button
                            key={rating}
                            type="button"
                            onClick={() => setInspectionForm({ ...inspectionForm, trash_compactor: rating as ConditionRating })}
                            className={`py-2 px-4 rounded-lg font-medium transition-colors ${
                              inspectionForm.trash_compactor === rating
                                ? 'bg-amber-500 text-slate-900'
                                : 'bg-slate-700 text-slate-300 hover:bg-slate-600'
                            }`}
                          >
                            {rating.charAt(0).toUpperCase() + rating.slice(1)}
                          </button>
                        ))}
                      </div>
                      <textarea
                        value={inspectionForm.trash_compactor_notes}
                        onChange={(e) => setInspectionForm({ ...inspectionForm, trash_compactor_notes: e.target.value })}
                        placeholder="Document issues..."
                        rows={2}
                        className="w-full px-4 py-3 bg-slate-900/50 border border-slate-600 rounded-lg focus:outline-none focus:border-amber-500 transition-colors text-white placeholder-slate-400 resize-none"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-medium mb-2">12 Volt Fans</label>
                      <div className="grid grid-cols-2 gap-3 mb-2">
                        {['ok', 'needs service'].map((rating) => (
                          <button
                            key={rating}
                            type="button"
                            onClick={() => setInspectionForm({ ...inspectionForm, volt_fans: rating as ConditionRating })}
                            className={`py-2 px-4 rounded-lg font-medium transition-colors ${
                              inspectionForm.volt_fans === rating
                                ? 'bg-amber-500 text-slate-900'
                                : 'bg-slate-700 text-slate-300 hover:bg-slate-600'
                            }`}
                          >
                            {rating.charAt(0).toUpperCase() + rating.slice(1)}
                          </button>
                        ))}
                      </div>
                      <textarea
                        value={inspectionForm.volt_fans_notes}
                        onChange={(e) => setInspectionForm({ ...inspectionForm, volt_fans_notes: e.target.value })}
                        placeholder="Document issues..."
                        rows={2}
                        className="w-full px-4 py-3 bg-slate-900/50 border border-slate-600 rounded-lg focus:outline-none focus:border-amber-500 transition-colors text-white placeholder-slate-400 resize-none"
                      />
                    </div>
                  </div>
                </div>

                <div className="bg-slate-800/50 backdrop-blur-sm rounded-2xl p-6 border border-slate-700">
                  <h3 className="text-lg font-semibold mb-4">Lower Basement Equipment</h3>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                      <label className="block text-sm font-medium mb-2">A/C Filters</label>
                      <div className="grid grid-cols-2 gap-3 mb-2">
                        {['ok', 'needs service'].map((rating) => (
                          <button
                            key={rating}
                            type="button"
                            onClick={() => setInspectionForm({ ...inspectionForm, ac_filters: rating as ConditionRating })}
                            className={`py-2 px-4 rounded-lg font-medium transition-colors ${
                              inspectionForm.ac_filters === rating
                                ? 'bg-amber-500 text-slate-900'
                                : 'bg-slate-700 text-slate-300 hover:bg-slate-600'
                            }`}
                          >
                            {rating.charAt(0).toUpperCase() + rating.slice(1)}
                          </button>
                        ))}
                      </div>
                      <textarea
                        value={inspectionForm.ac_filters_notes}
                        onChange={(e) => setInspectionForm({ ...inspectionForm, ac_filters_notes: e.target.value })}
                        placeholder="Document issues..."
                        rows={2}
                        className="w-full px-4 py-3 bg-slate-900/50 border border-slate-600 rounded-lg focus:outline-none focus:border-amber-500 transition-colors text-white placeholder-slate-400 resize-none"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-medium mb-2">A/C Water Pumps</label>
                      <div className="grid grid-cols-2 gap-3 mb-2">
                        {['ok', 'needs service'].map((rating) => (
                          <button
                            key={rating}
                            type="button"
                            onClick={() => setInspectionForm({ ...inspectionForm, ac_water_pumps: rating as ConditionRating })}
                            className={`py-2 px-4 rounded-lg font-medium transition-colors ${
                              inspectionForm.ac_water_pumps === rating
                                ? 'bg-amber-500 text-slate-900'
                                : 'bg-slate-700 text-slate-300 hover:bg-slate-600'
                            }`}
                          >
                            {rating.charAt(0).toUpperCase() + rating.slice(1)}
                          </button>
                        ))}
                      </div>
                      <textarea
                        value={inspectionForm.ac_water_pumps_notes}
                        onChange={(e) => setInspectionForm({ ...inspectionForm, ac_water_pumps_notes: e.target.value })}
                        placeholder="Document issues..."
                        rows={2}
                        className="w-full px-4 py-3 bg-slate-900/50 border border-slate-600 rounded-lg focus:outline-none focus:border-amber-500 transition-colors text-white placeholder-slate-400 resize-none"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-medium mb-2">Water Filters</label>
                      <div className="grid grid-cols-2 gap-3 mb-2">
                        {['ok', 'needs service'].map((rating) => (
                          <button
                            key={rating}
                            type="button"
                            onClick={() => setInspectionForm({ ...inspectionForm, water_filters: rating as ConditionRating })}
                            className={`py-2 px-4 rounded-lg font-medium transition-colors ${
                              inspectionForm.water_filters === rating
                                ? 'bg-amber-500 text-slate-900'
                                : 'bg-slate-700 text-slate-300 hover:bg-slate-600'
                            }`}
                          >
                            {rating.charAt(0).toUpperCase() + rating.slice(1)}
                          </button>
                        ))}
                      </div>
                      <textarea
                        value={inspectionForm.water_filters_notes}
                        onChange={(e) => setInspectionForm({ ...inspectionForm, water_filters_notes: e.target.value })}
                        placeholder="Document issues..."
                        rows={2}
                        className="w-full px-4 py-3 bg-slate-900/50 border border-slate-600 rounded-lg focus:outline-none focus:border-amber-500 transition-colors text-white placeholder-slate-400 resize-none"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-medium mb-2">Water Pumps and Controls</label>
                      <div className="grid grid-cols-2 gap-3 mb-2">
                        {['ok', 'needs service'].map((rating) => (
                          <button
                            key={rating}
                            type="button"
                            onClick={() => setInspectionForm({ ...inspectionForm, water_pumps_controls: rating as ConditionRating })}
                            className={`py-2 px-4 rounded-lg font-medium transition-colors ${
                              inspectionForm.water_pumps_controls === rating
                                ? 'bg-amber-500 text-slate-900'
                                : 'bg-slate-700 text-slate-300 hover:bg-slate-600'
                            }`}
                          >
                            {rating.charAt(0).toUpperCase() + rating.slice(1)}
                          </button>
                        ))}
                      </div>
                      <textarea
                        value={inspectionForm.water_pumps_controls_notes}
                        onChange={(e) => setInspectionForm({ ...inspectionForm, water_pumps_controls_notes: e.target.value })}
                        placeholder="Document issues..."
                        rows={2}
                        className="w-full px-4 py-3 bg-slate-900/50 border border-slate-600 rounded-lg focus:outline-none focus:border-amber-500 transition-colors text-white placeholder-slate-400 resize-none"
                      />
                    </div>
                  </div>
                </div>

                <div className="bg-slate-800/50 backdrop-blur-sm rounded-2xl p-6 border border-slate-700">
                  <h3 className="text-lg font-semibold mb-4">Upper Deck</h3>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                      <label className="block text-sm font-medium mb-2">Upper Deck Bathroom</label>
                      <div className="grid grid-cols-2 gap-3 mb-2">
                        {['ok', 'needs service'].map((rating) => (
                          <button
                            key={rating}
                            type="button"
                            onClick={() => setInspectionForm({ ...inspectionForm, engine_condition: rating as ConditionRating })}
                            className={`py-2 px-4 rounded-lg font-medium transition-colors ${
                              inspectionForm.engine_condition === rating
                                ? 'bg-amber-500 text-slate-900'
                                : 'bg-slate-700 text-slate-300 hover:bg-slate-600'
                            }`}
                          >
                            {rating.charAt(0).toUpperCase() + rating.slice(1)}
                          </button>
                        ))}
                      </div>
                      <textarea
                        value={inspectionForm.engine_notes}
                        onChange={(e) => setInspectionForm({ ...inspectionForm, engine_notes: e.target.value })}
                        placeholder="Document issues..."
                        rows={2}
                        className="w-full px-4 py-3 bg-slate-900/50 border border-slate-600 rounded-lg focus:outline-none focus:border-amber-500 transition-colors text-white placeholder-slate-400 resize-none"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-medium mb-2">Kitchen Sink</label>
                      <div className="grid grid-cols-2 gap-3 mb-2">
                        {['ok', 'needs service'].map((rating) => (
                          <button
                            key={rating}
                            type="button"
                            onClick={() => setInspectionForm({ ...inspectionForm, engine_condition: rating as ConditionRating })}
                            className={`py-2 px-4 rounded-lg font-medium transition-colors ${
                              inspectionForm.engine_condition === rating
                                ? 'bg-amber-500 text-slate-900'
                                : 'bg-slate-700 text-slate-300 hover:bg-slate-600'
                            }`}
                          >
                            {rating.charAt(0).toUpperCase() + rating.slice(1)}
                          </button>
                        ))}
                      </div>
                      <textarea
                        value={inspectionForm.engine_notes}
                        onChange={(e) => setInspectionForm({ ...inspectionForm, engine_notes: e.target.value })}
                        placeholder="Document issues..."
                        rows={2}
                        className="w-full px-4 py-3 bg-slate-900/50 border border-slate-600 rounded-lg focus:outline-none focus:border-amber-500 transition-colors text-white placeholder-slate-400 resize-none"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-medium mb-2">Disposal</label>
                      <div className="grid grid-cols-2 gap-3 mb-2">
                        {['ok', 'needs service'].map((rating) => (
                          <button
                            key={rating}
                            type="button"
                            onClick={() => setInspectionForm({ ...inspectionForm, engine_condition: rating as ConditionRating })}
                            className={`py-2 px-4 rounded-lg font-medium transition-colors ${
                              inspectionForm.engine_condition === rating
                                ? 'bg-amber-500 text-slate-900'
                                : 'bg-slate-700 text-slate-300 hover:bg-slate-600'
                            }`}
                          >
                            {rating.charAt(0).toUpperCase() + rating.slice(1)}
                          </button>
                        ))}
                      </div>
                      <textarea
                        value={inspectionForm.engine_notes}
                        onChange={(e) => setInspectionForm({ ...inspectionForm, engine_notes: e.target.value })}
                        placeholder="Document issues..."
                        rows={2}
                        className="w-full px-4 py-3 bg-slate-900/50 border border-slate-600 rounded-lg focus:outline-none focus:border-amber-500 transition-colors text-white placeholder-slate-400 resize-none"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-medium mb-2">Icemaker</label>
                      <div className="grid grid-cols-2 gap-3 mb-2">
                        {['ok', 'needs service'].map((rating) => (
                          <button
                            key={rating}
                            type="button"
                            onClick={() => setInspectionForm({ ...inspectionForm, engine_condition: rating as ConditionRating })}
                            className={`py-2 px-4 rounded-lg font-medium transition-colors ${
                              inspectionForm.engine_condition === rating
                                ? 'bg-amber-500 text-slate-900'
                                : 'bg-slate-700 text-slate-300 hover:bg-slate-600'
                            }`}
                          >
                            {rating.charAt(0).toUpperCase() + rating.slice(1)}
                          </button>
                        ))}
                      </div>
                      <textarea
                        value={inspectionForm.engine_notes}
                        onChange={(e) => setInspectionForm({ ...inspectionForm, engine_notes: e.target.value })}
                        placeholder="Document issues..."
                        rows={2}
                        className="w-full px-4 py-3 bg-slate-900/50 border border-slate-600 rounded-lg focus:outline-none focus:border-amber-500 transition-colors text-white placeholder-slate-400 resize-none"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-medium mb-2">Stove Top</label>
                      <div className="grid grid-cols-2 gap-3 mb-2">
                        {['ok', 'needs service'].map((rating) => (
                          <button
                            key={rating}
                            type="button"
                            onClick={() => setInspectionForm({ ...inspectionForm, engine_condition: rating as ConditionRating })}
                            className={`py-2 px-4 rounded-lg font-medium transition-colors ${
                              inspectionForm.engine_condition === rating
                                ? 'bg-amber-500 text-slate-900'
                                : 'bg-slate-700 text-slate-300 hover:bg-slate-600'
                            }`}
                          >
                            {rating.charAt(0).toUpperCase() + rating.slice(1)}
                          </button>
                        ))}
                      </div>
                      <textarea
                        value={inspectionForm.engine_notes}
                        onChange={(e) => setInspectionForm({ ...inspectionForm, engine_notes: e.target.value })}
                        placeholder="Document issues..."
                        rows={2}
                        className="w-full px-4 py-3 bg-slate-900/50 border border-slate-600 rounded-lg focus:outline-none focus:border-amber-500 transition-colors text-white placeholder-slate-400 resize-none"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-medium mb-2">Propane Filled and Connected</label>
                      <div className="grid grid-cols-2 gap-3 mb-2">
                        {['ok', 'needs service'].map((rating) => (
                          <button
                            key={rating}
                            type="button"
                            onClick={() => setInspectionForm({ ...inspectionForm, engine_condition: rating as ConditionRating })}
                            className={`py-2 px-4 rounded-lg font-medium transition-colors ${
                              inspectionForm.engine_condition === rating
                                ? 'bg-amber-500 text-slate-900'
                                : 'bg-slate-700 text-slate-300 hover:bg-slate-600'
                            }`}
                          >
                            {rating.charAt(0).toUpperCase() + rating.slice(1)}
                          </button>
                        ))}
                      </div>
                      <textarea
                        value={inspectionForm.engine_notes}
                        onChange={(e) => setInspectionForm({ ...inspectionForm, engine_notes: e.target.value })}
                        placeholder="Document issues..."
                        rows={2}
                        className="w-full px-4 py-3 bg-slate-900/50 border border-slate-600 rounded-lg focus:outline-none focus:border-amber-500 transition-colors text-white placeholder-slate-400 resize-none"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-medium mb-2">Windless Anchors Port Side</label>
                      <div className="grid grid-cols-2 gap-3 mb-2">
                        {['ok', 'needs service'].map((rating) => (
                          <button
                            key={rating}
                            type="button"
                            onClick={() => setInspectionForm({ ...inspectionForm, engine_condition: rating as ConditionRating })}
                            className={`py-2 px-4 rounded-lg font-medium transition-colors ${
                              inspectionForm.engine_condition === rating
                                ? 'bg-amber-500 text-slate-900'
                                : 'bg-slate-700 text-slate-300 hover:bg-slate-600'
                            }`}
                          >
                            {rating.charAt(0).toUpperCase() + rating.slice(1)}
                          </button>
                        ))}
                      </div>
                      <textarea
                        value={inspectionForm.engine_notes}
                        onChange={(e) => setInspectionForm({ ...inspectionForm, engine_notes: e.target.value })}
                        placeholder="Document issues..."
                        rows={2}
                        className="w-full px-4 py-3 bg-slate-900/50 border border-slate-600 rounded-lg focus:outline-none focus:border-amber-500 transition-colors text-white placeholder-slate-400 resize-none"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-medium mb-2">Windless Anchor Starboard</label>
                      <div className="grid grid-cols-2 gap-3 mb-2">
                        {['ok', 'needs service'].map((rating) => (
                          <button
                            key={rating}
                            type="button"
                            onClick={() => setInspectionForm({ ...inspectionForm, engine_condition: rating as ConditionRating })}
                            className={`py-2 px-4 rounded-lg font-medium transition-colors ${
                              inspectionForm.engine_condition === rating
                                ? 'bg-amber-500 text-slate-900'
                                : 'bg-slate-700 text-slate-300 hover:bg-slate-600'
                            }`}
                          >
                            {rating.charAt(0).toUpperCase() + rating.slice(1)}
                          </button>
                        ))}
                      </div>
                      <textarea
                        value={inspectionForm.engine_notes}
                        onChange={(e) => setInspectionForm({ ...inspectionForm, engine_notes: e.target.value })}
                        placeholder="Document issues..."
                        rows={2}
                        className="w-full px-4 py-3 bg-slate-900/50 border border-slate-600 rounded-lg focus:outline-none focus:border-amber-500 transition-colors text-white placeholder-slate-400 resize-none"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-medium mb-2">Anchors Lines</label>
                      <div className="grid grid-cols-2 gap-3 mb-2">
                        {['ok', 'needs service'].map((rating) => (
                          <button
                            key={rating}
                            type="button"
                            onClick={() => setInspectionForm({ ...inspectionForm, engine_condition: rating as ConditionRating })}
                            className={`py-2 px-4 rounded-lg font-medium transition-colors ${
                              inspectionForm.engine_condition === rating
                                ? 'bg-amber-500 text-slate-900'
                                : 'bg-slate-700 text-slate-300 hover:bg-slate-600'
                            }`}
                          >
                            {rating.charAt(0).toUpperCase() + rating.slice(1)}
                          </button>
                        ))}
                      </div>
                      <textarea
                        value={inspectionForm.engine_notes}
                        onChange={(e) => setInspectionForm({ ...inspectionForm, engine_notes: e.target.value })}
                        placeholder="Document issues..."
                        rows={2}
                        className="w-full px-4 py-3 bg-slate-900/50 border border-slate-600 rounded-lg focus:outline-none focus:border-amber-500 transition-colors text-white placeholder-slate-400 resize-none"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-medium mb-2">A/C Filter</label>
                      <div className="grid grid-cols-2 gap-3 mb-2">
                        {['ok', 'needs service'].map((rating) => (
                          <button
                            key={rating}
                            type="button"
                            onClick={() => setInspectionForm({ ...inspectionForm, engine_condition: rating as ConditionRating })}
                            className={`py-2 px-4 rounded-lg font-medium transition-colors ${
                              inspectionForm.engine_condition === rating
                                ? 'bg-amber-500 text-slate-900'
                                : 'bg-slate-700 text-slate-300 hover:bg-slate-600'
                            }`}
                          >
                            {rating.charAt(0).toUpperCase() + rating.slice(1)}
                          </button>
                        ))}
                      </div>
                      <textarea
                        value={inspectionForm.engine_notes}
                        onChange={(e) => setInspectionForm({ ...inspectionForm, engine_notes: e.target.value })}
                        placeholder="Document issues..."
                        rows={2}
                        className="w-full px-4 py-3 bg-slate-900/50 border border-slate-600 rounded-lg focus:outline-none focus:border-amber-500 transition-colors text-white placeholder-slate-400 resize-none"
                      />
                    </div>
                  </div>
                </div>

                <div className="bg-slate-800/50 backdrop-blur-sm rounded-2xl p-6 border border-slate-700">
                  <h3 className="text-lg font-semibold mb-4">Engine Compartment</h3>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                      <label className="block text-sm font-medium mb-2">Port Engine Oil</label>
                      <div className="grid grid-cols-2 gap-3 mb-2">
                        {['ok', 'needs service'].map((rating) => (
                          <button
                            key={rating}
                            type="button"
                            onClick={() => setInspectionForm({ ...inspectionForm, engine_condition: rating as ConditionRating })}
                            className={`py-2 px-4 rounded-lg font-medium transition-colors ${
                              inspectionForm.engine_condition === rating
                                ? 'bg-amber-500 text-slate-900'
                                : 'bg-slate-700 text-slate-300 hover:bg-slate-600'
                            }`}
                          >
                            {rating.charAt(0).toUpperCase() + rating.slice(1)}
                          </button>
                        ))}
                      </div>
                      <textarea
                        value={inspectionForm.engine_notes}
                        onChange={(e) => setInspectionForm({ ...inspectionForm, engine_notes: e.target.value })}
                        placeholder="Document issues..."
                        rows={2}
                        className="w-full px-4 py-3 bg-slate-900/50 border border-slate-600 rounded-lg focus:outline-none focus:border-amber-500 transition-colors text-white placeholder-slate-400 resize-none"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-medium mb-2">Port Generator Oil</label>
                      <div className="grid grid-cols-2 gap-3 mb-2">
                        {['ok', 'needs service'].map((rating) => (
                          <button
                            key={rating}
                            type="button"
                            onClick={() => setInspectionForm({ ...inspectionForm, engine_condition: rating as ConditionRating })}
                            className={`py-2 px-4 rounded-lg font-medium transition-colors ${
                              inspectionForm.engine_condition === rating
                                ? 'bg-amber-500 text-slate-900'
                                : 'bg-slate-700 text-slate-300 hover:bg-slate-600'
                            }`}
                          >
                            {rating.charAt(0).toUpperCase() + rating.slice(1)}
                          </button>
                        ))}
                      </div>
                      <textarea
                        value={inspectionForm.engine_notes}
                        onChange={(e) => setInspectionForm({ ...inspectionForm, engine_notes: e.target.value })}
                        placeholder="Document issues..."
                        rows={2}
                        className="w-full px-4 py-3 bg-slate-900/50 border border-slate-600 rounded-lg focus:outline-none focus:border-amber-500 transition-colors text-white placeholder-slate-400 resize-none"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-medium mb-2">Starboard Generator Oil</label>
                      <div className="grid grid-cols-2 gap-3 mb-2">
                        {['ok', 'needs service'].map((rating) => (
                          <button
                            key={rating}
                            type="button"
                            onClick={() => setInspectionForm({ ...inspectionForm, engine_condition: rating as ConditionRating })}
                            className={`py-2 px-4 rounded-lg font-medium transition-colors ${
                              inspectionForm.engine_condition === rating
                                ? 'bg-amber-500 text-slate-900'
                                : 'bg-slate-700 text-slate-300 hover:bg-slate-600'
                            }`}
                          >
                            {rating.charAt(0).toUpperCase() + rating.slice(1)}
                          </button>
                        ))}
                      </div>
                      <textarea
                        value={inspectionForm.engine_notes}
                        onChange={(e) => setInspectionForm({ ...inspectionForm, engine_notes: e.target.value })}
                        placeholder="Document issues..."
                        rows={2}
                        className="w-full px-4 py-3 bg-slate-900/50 border border-slate-600 rounded-lg focus:outline-none focus:border-amber-500 transition-colors text-white placeholder-slate-400 resize-none"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-medium mb-2">Starboard Engine Oil</label>
                      <div className="grid grid-cols-2 gap-3 mb-2">
                        {['ok', 'needs service'].map((rating) => (
                          <button
                            key={rating}
                            type="button"
                            onClick={() => setInspectionForm({ ...inspectionForm, engine_condition: rating as ConditionRating })}
                            className={`py-2 px-4 rounded-lg font-medium transition-colors ${
                              inspectionForm.engine_condition === rating
                                ? 'bg-amber-500 text-slate-900'
                                : 'bg-slate-700 text-slate-300 hover:bg-slate-600'
                            }`}
                          >
                            {rating.charAt(0).toUpperCase() + rating.slice(1)}
                          </button>
                        ))}
                      </div>
                      <textarea
                        value={inspectionForm.engine_notes}
                        onChange={(e) => setInspectionForm({ ...inspectionForm, engine_notes: e.target.value })}
                        placeholder="Document issues..."
                        rows={2}
                        className="w-full px-4 py-3 bg-slate-900/50 border border-slate-600 rounded-lg focus:outline-none focus:border-amber-500 transition-colors text-white placeholder-slate-400 resize-none"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-medium mb-2">Sea Strainers</label>
                      <div className="grid grid-cols-2 gap-3 mb-2">
                        {['ok', 'needs service'].map((rating) => (
                          <button
                            key={rating}
                            type="button"
                            onClick={() => setInspectionForm({ ...inspectionForm, engine_condition: rating as ConditionRating })}
                            className={`py-2 px-4 rounded-lg font-medium transition-colors ${
                              inspectionForm.engine_condition === rating
                                ? 'bg-amber-500 text-slate-900'
                                : 'bg-slate-700 text-slate-300 hover:bg-slate-600'
                            }`}
                          >
                            {rating.charAt(0).toUpperCase() + rating.slice(1)}
                          </button>
                        ))}
                      </div>
                      <textarea
                        value={inspectionForm.engine_notes}
                        onChange={(e) => setInspectionForm({ ...inspectionForm, engine_notes: e.target.value })}
                        placeholder="Document issues..."
                        rows={2}
                        className="w-full px-4 py-3 bg-slate-900/50 border border-slate-600 rounded-lg focus:outline-none focus:border-amber-500 transition-colors text-white placeholder-slate-400 resize-none"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-medium mb-2">Engine Batteries</label>
                      <div className="grid grid-cols-2 gap-3 mb-2">
                        {['ok', 'needs service'].map((rating) => (
                          <button
                            key={rating}
                            type="button"
                            onClick={() => setInspectionForm({ ...inspectionForm, engine_condition: rating as ConditionRating })}
                            className={`py-2 px-4 rounded-lg font-medium transition-colors ${
                              inspectionForm.engine_condition === rating
                                ? 'bg-amber-500 text-slate-900'
                                : 'bg-slate-700 text-slate-300 hover:bg-slate-600'
                            }`}
                          >
                            {rating.charAt(0).toUpperCase() + rating.slice(1)}
                          </button>
                        ))}
                      </div>
                      <textarea
                        value={inspectionForm.engine_notes}
                        onChange={(e) => setInspectionForm({ ...inspectionForm, engine_notes: e.target.value })}
                        placeholder="Document issues..."
                        rows={2}
                        className="w-full px-4 py-3 bg-slate-900/50 border border-slate-600 rounded-lg focus:outline-none focus:border-amber-500 transition-colors text-white placeholder-slate-400 resize-none"
                      />
                    </div>
                  </div>
                </div>

                <div className="bg-slate-800/50 backdrop-blur-sm rounded-2xl p-6 border border-slate-700">
                  <h3 className="text-lg font-semibold mb-4">Any Other Issues</h3>
                  <div className="space-y-6">
                    <div>
                      <label htmlFor="additionalNotes" className="block text-sm font-medium mb-2">
                        Additional Notes
                      </label>
                      <textarea
                        id="additionalNotes"
                        value={inspectionForm.additional_notes}
                        onChange={(e) => setInspectionForm({ ...inspectionForm, additional_notes: e.target.value })}
                        placeholder="Any other observations or concerns..."
                        rows={4}
                        className="w-full px-4 py-3 bg-slate-900/50 border border-slate-600 rounded-lg focus:outline-none focus:border-amber-500 transition-colors text-white placeholder-slate-400 resize-none"
                      />
                    </div>

                    <div className="flex items-center gap-3">
                      <input
                        id="issuesFound"
                        type="checkbox"
                        checked={inspectionForm.issues_found}
                        onChange={(e) => setInspectionForm({ ...inspectionForm, issues_found: e.target.checked })}
                        className="w-5 h-5 rounded bg-slate-700 border-slate-600 text-amber-500 focus:ring-amber-500"
                      />
                      <label htmlFor="issuesFound" className="text-sm font-medium">
                        Issues found that require attention
                      </label>
                    </div>
                  </div>
                </div>

                {inspectionError && (
                  <div className="bg-red-500/10 border border-red-500 text-red-500 px-4 py-3 rounded-lg text-sm">
                    {inspectionError}
                  </div>
                )}

                {inspectionSuccess && (
                  <div className="bg-green-500/10 border border-green-500 text-green-500 px-4 py-3 rounded-lg text-sm">
                    Inspection submitted successfully!
                  </div>
                )}

                <button
                  type="submit"
                  disabled={inspectionLoading}
                  className="w-full bg-amber-500 hover:bg-amber-600 text-slate-900 font-semibold py-4 rounded-lg transition-all duration-300 shadow-lg disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"
                >
                  <ClipboardCheck className="w-5 h-5" />
                  {inspectionLoading ? 'Submitting...' : 'Submit Inspection'}
                </button>
              </form>
                </>
              ) : adminView === 'yachts' ? (
                <>
                  <button
                    onClick={() => setAdminView('menu')}
                    className="flex items-center gap-2 text-slate-400 hover:text-blue-500 transition-colors mb-4"
                  >
                    <span>← Back to Admin Menu</span>
                  </button>

                  <div className="flex items-center justify-between mb-6">
                    <div className="flex items-center gap-3">
                      <Ship className="w-8 h-8 text-blue-500" />
                      <div>
                        <h2 className="text-2xl font-bold">Yacht Management</h2>
                        <p className="text-slate-400">View and manage yacht fleet</p>
                      </div>
                    </div>
                    <button
                      onClick={() => setShowYachtForm(!showYachtForm)}
                      className="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg font-semibold transition-all duration-300 shadow-lg"
                    >
                      {showYachtForm ? 'Cancel' : '+ Add Yacht'}
                    </button>
                  </div>

                  {showYachtForm && (
                    <div className="bg-slate-800/50 backdrop-blur-sm rounded-2xl p-6 border border-slate-700 mb-6">
                      <h3 className="text-xl font-semibold mb-4">Add New Yacht</h3>
                      <form onSubmit={async (e) => {
                        e.preventDefault();
                        setYachtLoading(true);
                        setYachtError('');

                        try {
                          const { data: newYacht, error } = await supabase.from('yachts').insert({
                            name: yachtForm.name,
                            hull_number: yachtForm.hull_number,
                            year: yachtForm.year ? parseInt(yachtForm.year) : null,
                            size: yachtForm.size,
                            port_engine: yachtForm.port_engine,
                            starboard_engine: yachtForm.starboard_engine,
                            port_generator: yachtForm.port_generator,
                            starboard_generator: yachtForm.starboard_generator,
                            owner_id: user?.id
                          }).select().single();

                          if (error) throw error;

                          if (newYacht) {
                            const userName = userProfile?.first_name && userProfile?.last_name
                              ? `${userProfile.first_name} ${userProfile.last_name}`
                              : userProfile?.email || 'Unknown';
                            await logYachtActivity(
                              newYacht.id,
                              newYacht.name,
                              `Yacht "${newYacht.name}" was added to the fleet`,
                              user?.id,
                              userName
                            );
                          }

                          setYachtSuccess(true);
                          setYachtForm({
                            name: '',
                            hull_number: '',
                            manufacturer: '',
                            year: '',
                            size: '',
                            port_engine: '',
                            starboard_engine: '',
                            port_generator: '',
                            starboard_generator: ''
                          });
                          setShowYachtForm(false);
                          await loadAllYachts();

                          setTimeout(() => setYachtSuccess(false), 3000);
                        } catch (err: any) {
                          setYachtError(err.message || 'Failed to add yacht');
                        } finally {
                          setYachtLoading(false);
                        }
                      }} className="space-y-4">
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                          <div>
                            <label className="block text-sm font-medium mb-2">Yacht Name *</label>
                            <input
                              type="text"
                              required
                              value={yachtForm.name}
                              onChange={(e) => setYachtForm({...yachtForm, name: e.target.value})}
                              className="w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-3 focus:outline-none focus:border-blue-500"
                              placeholder="e.g., Sea Dream"
                            />
                          </div>
                          <div>
                            <label className="block text-sm font-medium mb-2">Hull Number</label>
                            <input
                              type="text"
                              value={yachtForm.hull_number}
                              onChange={(e) => setYachtForm({...yachtForm, hull_number: e.target.value})}
                              className="w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-3 focus:outline-none focus:border-blue-500"
                              placeholder="e.g., HIN123456"
                            />
                          </div>
                          <div>
                            <label className="block text-sm font-medium mb-2">Manufacturer</label>
                            <input
                              type="text"
                              value={yachtForm.manufacturer}
                              onChange={(e) => setYachtForm({...yachtForm, manufacturer: e.target.value})}
                              className="w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-3 focus:outline-none focus:border-blue-500"
                              placeholder="e.g., Sunseeker, Azimut"
                            />
                          </div>
                          <div>
                            <label className="block text-sm font-medium mb-2">Year</label>
                            <input
                              type="number"
                              value={yachtForm.year}
                              onChange={(e) => setYachtForm({...yachtForm, year: e.target.value})}
                              className="w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-3 focus:outline-none focus:border-blue-500"
                              placeholder="e.g., 2020"
                            />
                          </div>
                          <div>
                            <label className="block text-sm font-medium mb-2">Size</label>
                            <input
                              type="text"
                              value={yachtForm.size}
                              onChange={(e) => setYachtForm({...yachtForm, size: e.target.value})}
                              className="w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-3 focus:outline-none focus:border-blue-500"
                              placeholder="e.g., 75 ft"
                            />
                          </div>
                          <div>
                            <label className="block text-sm font-medium mb-2">Port Engine</label>
                            <input
                              type="text"
                              value={yachtForm.port_engine}
                              onChange={(e) => setYachtForm({...yachtForm, port_engine: e.target.value})}
                              className="w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-3 focus:outline-none focus:border-blue-500"
                              placeholder="e.g., Cat C18 1000HP"
                            />
                          </div>
                          <div>
                            <label className="block text-sm font-medium mb-2">Starboard Engine</label>
                            <input
                              type="text"
                              value={yachtForm.starboard_engine}
                              onChange={(e) => setYachtForm({...yachtForm, starboard_engine: e.target.value})}
                              className="w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-3 focus:outline-none focus:border-blue-500"
                              placeholder="e.g., Cat C18 1000HP"
                            />
                          </div>
                          <div>
                            <label className="block text-sm font-medium mb-2">Port Generator</label>
                            <input
                              type="text"
                              value={yachtForm.port_generator}
                              onChange={(e) => setYachtForm({...yachtForm, port_generator: e.target.value})}
                              className="w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-3 focus:outline-none focus:border-blue-500"
                              placeholder="e.g., Northern Lights 27kW"
                            />
                          </div>
                          <div>
                            <label className="block text-sm font-medium mb-2">Starboard Generator</label>
                            <input
                              type="text"
                              value={yachtForm.starboard_generator}
                              onChange={(e) => setYachtForm({...yachtForm, starboard_generator: e.target.value})}
                              className="w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-3 focus:outline-none focus:border-blue-500"
                              placeholder="e.g., Northern Lights 27kW"
                            />
                          </div>
                        </div>

                        {yachtError && (
                          <div className="bg-red-500/10 border border-red-500 text-red-500 px-4 py-3 rounded-lg text-sm">
                            {yachtError}
                          </div>
                        )}

                        <button
                          type="submit"
                          disabled={yachtLoading}
                          className="w-full bg-blue-500 hover:bg-blue-600 text-white font-semibold py-4 rounded-lg transition-all duration-300 shadow-lg disabled:opacity-50 disabled:cursor-not-allowed"
                        >
                          {yachtLoading ? 'Adding Yacht...' : 'Add Yacht'}
                        </button>
                      </form>
                    </div>
                  )}

                  {yachtSuccess && (
                    <div className="bg-green-500/10 border border-green-500 text-green-500 px-4 py-3 rounded-lg text-sm mb-6">
                      Yacht added successfully!
                    </div>
                  )}

                  <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    {allYachts.map((yacht) => (
                      <div key={yacht.id} className="bg-slate-800/50 backdrop-blur-sm rounded-2xl p-6 border border-slate-700 hover:border-blue-500 transition-all">
                        <div className="flex items-start justify-between mb-4">
                          <div>
                            <h3 className="text-xl font-bold text-white mb-1">{yacht.name}</h3>
                            <p className="text-sm text-slate-400">Yacht History</p>
                          </div>
                          <Ship className="w-6 h-6 text-blue-500" />
                        </div>

                        <div className="space-y-2 text-sm mb-4">
                          {yacht.manufacturer && (
                            <div className="flex justify-between">
                              <span className="text-slate-400">Manufacturer:</span>
                              <span className="text-white font-medium">{yacht.manufacturer}</span>
                            </div>
                          )}
                          {yacht.year && (
                            <div className="flex justify-between">
                              <span className="text-slate-400">Year:</span>
                              <span className="text-white font-medium">{yacht.year}</span>
                            </div>
                          )}
                          {yacht.size && (
                            <div className="flex justify-between">
                              <span className="text-slate-400">Size:</span>
                              <span className="text-white font-medium">{yacht.size}</span>
                            </div>
                          )}
                          {yacht.hull_number && (
                            <div className="flex justify-between">
                              <span className="text-slate-400">Hull Number:</span>
                              <span className="text-white font-medium">{yacht.hull_number}</span>
                            </div>
                          )}
                        </div>

                        <button
                          onClick={() => toggleYachtHistory(yacht.id)}
                          className="w-full flex items-center justify-center gap-2 px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition-colors text-sm"
                        >
                          <History className="w-4 h-4" />
                          {expandedYachtId === yacht.id ? 'Hide History' : 'View History'}
                        </button>

                        {expandedYachtId === yacht.id && (
                          <div className="mt-4 pt-4 border-t border-slate-700">
                            <h4 className="text-sm font-semibold text-slate-300 mb-3">Activity Log</h4>
                            <div className="space-y-2 max-h-64 overflow-y-auto">
                              {yachtHistoryLogs[yacht.id]?.length > 0 ? (
                                yachtHistoryLogs[yacht.id].map((log) => (
                                  <div key={log.id} className="bg-slate-900/50 rounded-lg p-3 text-xs">
                                    <div className="text-slate-300 mb-1">{log.action}</div>
                                    <div className="text-slate-500 flex items-center gap-2">
                                      <span>{new Date(log.created_at).toLocaleString()}</span>
                                      {log.created_by_name && <span>• {log.created_by_name}</span>}
                                    </div>
                                  </div>
                                ))
                              ) : (
                                <div className="text-slate-500 text-xs text-center py-4">
                                  No activity logged yet
                                </div>
                              )}
                            </div>
                          </div>
                        )}
                      </div>
                    ))}
                  </div>
                </>
              ) : adminView === 'ownertrips' ? (
                <>
                  <button
                    onClick={() => setAdminView('menu')}
                    className="flex items-center gap-2 text-slate-400 hover:text-green-500 transition-colors mb-4"
                  >
                    <span>← Back to Admin Menu</span>
                  </button>

                  <div className="flex items-center justify-between mb-6">
                    <div className="flex items-center gap-3">
                      <CalendarPlus className="w-8 h-8 text-green-500" />
                      <div>
                        <h2 className="text-2xl font-bold">Owner Trips</h2>
                        <p className="text-slate-400">Schedule owner yacht trips to calendar</p>
                      </div>
                    </div>
                    <button
                      onClick={() => setShowOwnerTripForm(!showOwnerTripForm)}
                      className="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg font-semibold transition-all duration-300 shadow-lg"
                    >
                      {showOwnerTripForm ? 'Cancel' : '+ Add Owner Trip'}
                    </button>
                  </div>

                  {showOwnerTripForm && (
                    <div className="bg-slate-800/50 backdrop-blur-sm rounded-2xl p-6 border border-slate-700 mb-6">
                      <h3 className="text-xl font-semibold mb-4">Add Owner Trip to Calendar</h3>
                      <form onSubmit={async (e) => {
                        e.preventDefault();
                        setOwnerTripLoading(true);
                        setOwnerTripError('');

                        try {
                          if (!yacht) {
                            throw new Error('No yacht selected');
                          }

                          const startDateTime = `${ownerTripForm.start_date}T${ownerTripForm.departure_time || '00:00'}:00`;
                          const endDateTime = `${ownerTripForm.end_date}T${ownerTripForm.arrival_time || '00:00'}:00`;

                          const { error } = await supabase.from('yacht_bookings').insert({
                            yacht_id: yacht.id,
                            user_id: user?.id || '',
                            start_date: startDateTime,
                            end_date: endDateTime,
                            owner_name: ownerTripForm.owner_name,
                            owner_contact: ownerTripForm.owner_contact,
                            departure_time: ownerTripForm.departure_time,
                            arrival_time: ownerTripForm.arrival_time,
                            notes: 'Owner trip',
                            checked_in: false,
                            checked_out: false
                          });

                          if (error) throw error;

                          const userName = userProfile?.first_name && userProfile?.last_name
                            ? `${userProfile.first_name} ${userProfile.last_name}`
                            : userProfile?.email || 'Unknown';
                          await logYachtActivity(
                            yacht.id,
                            yacht.name,
                            `Owner trip scheduled for ${ownerTripForm.owner_name} from ${new Date(startDateTime).toLocaleDateString()} to ${new Date(endDateTime).toLocaleDateString()}`,
                            user?.id,
                            userName
                          );

                          setOwnerTripSuccess(true);
                          setOwnerTripForm({
                            owner_name: '',
                            owner_contact: '',
                            start_date: '',
                            departure_time: '',
                            end_date: '',
                            arrival_time: ''
                          });
                          setShowOwnerTripForm(false);
                          loadBookings();

                          setTimeout(() => setOwnerTripSuccess(false), 3000);
                        } catch (err: any) {
                          setOwnerTripError(err.message || 'Failed to add owner trip');
                        } finally {
                          setOwnerTripLoading(false);
                        }
                      }} className="space-y-4">
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                          <div>
                            <label className="block text-sm font-medium mb-2">Owner Name *</label>
                            <select
                              required
                              value={ownerTripForm.owner_name}
                              onChange={(e) => {
                                const selectedUser = allUsers.find(u =>
                                  `${u.first_name || ''} ${u.last_name || ''}`.trim() === e.target.value
                                );
                                setOwnerTripForm({
                                  ...ownerTripForm,
                                  owner_name: e.target.value,
                                  owner_contact: selectedUser?.phone || ownerTripForm.owner_contact
                                });
                              }}
                              className="w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-3 focus:outline-none focus:border-green-500"
                            >
                              <option value="">Select an owner</option>
                              {allUsers.map((user) => {
                                const fullName = `${user.first_name || ''} ${user.last_name || ''}`.trim();
                                return fullName ? (
                                  <option key={user.id} value={fullName}>
                                    {fullName}
                                  </option>
                                ) : null;
                              })}
                            </select>
                          </div>
                          <div>
                            <label className="block text-sm font-medium mb-2">Contact Information *</label>
                            <input
                              type="text"
                              required
                              value={ownerTripForm.owner_contact}
                              onChange={(e) => setOwnerTripForm({...ownerTripForm, owner_contact: e.target.value})}
                              className="w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-3 focus:outline-none focus:border-green-500"
                              placeholder="john@example.com or (555) 123-4567"
                            />
                          </div>
                          <div>
                            <label className="block text-sm font-medium mb-2">Start Date *</label>
                            <input
                              type="date"
                              required
                              value={ownerTripForm.start_date}
                              onChange={(e) => setOwnerTripForm({...ownerTripForm, start_date: e.target.value})}
                              className="w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-3 focus:outline-none focus:border-green-500"
                            />
                          </div>
                          <div>
                            <label className="block text-sm font-medium mb-2">Departure Time</label>
                            <input
                              type="time"
                              value={ownerTripForm.departure_time}
                              onChange={(e) => setOwnerTripForm({...ownerTripForm, departure_time: e.target.value})}
                              className="w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-3 focus:outline-none focus:border-green-500"
                            />
                          </div>
                          <div>
                            <label className="block text-sm font-medium mb-2">Return Date *</label>
                            <input
                              type="date"
                              required
                              value={ownerTripForm.end_date}
                              onChange={(e) => setOwnerTripForm({...ownerTripForm, end_date: e.target.value})}
                              className="w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-3 focus:outline-none focus:border-green-500"
                            />
                          </div>
                          <div>
                            <label className="block text-sm font-medium mb-2">Arrival Time</label>
                            <input
                              type="time"
                              value={ownerTripForm.arrival_time}
                              onChange={(e) => setOwnerTripForm({...ownerTripForm, arrival_time: e.target.value})}
                              className="w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-3 focus:outline-none focus:border-green-500"
                            />
                          </div>
                        </div>

                        {ownerTripError && (
                          <div className="bg-red-500/10 border border-red-500 text-red-500 px-4 py-3 rounded-lg text-sm">
                            {ownerTripError}
                          </div>
                        )}

                        <button
                          type="submit"
                          disabled={ownerTripLoading}
                          className="w-full bg-green-500 hover:bg-green-600 text-white font-semibold py-4 rounded-lg transition-all duration-300 shadow-lg disabled:opacity-50 disabled:cursor-not-allowed"
                        >
                          {ownerTripLoading ? 'Adding Trip...' : 'Add Owner Trip'}
                        </button>
                      </form>
                    </div>
                  )}

                  {ownerTripSuccess && (
                    <div className="bg-green-500/10 border border-green-500 text-green-500 px-4 py-3 rounded-lg text-sm mb-6">
                      Owner trip added to calendar successfully!
                    </div>
                  )}
                </>
              ) : adminView === 'repairs' ? (
                <>
                  <button
                    onClick={() => setAdminView('menu')}
                    className="flex items-center gap-2 text-slate-400 hover:text-orange-500 transition-colors mb-4"
                  >
                    <span>← Back to Admin Menu</span>
                  </button>

                  <div className="flex items-center justify-between mb-6">
                    <div className="flex items-center gap-3">
                      <FileUp className="w-8 h-8 text-orange-500" />
                      <div>
                        <h2 className="text-2xl font-bold">Repair Requests</h2>
                        <p className="text-slate-400">Upload files and submit repair requests for approval</p>
                      </div>
                    </div>
                    <button
                      onClick={() => setShowRepairForm(!showRepairForm)}
                      className="bg-orange-500 hover:bg-orange-600 text-white px-6 py-3 rounded-lg font-semibold transition-all duration-300 shadow-lg"
                    >
                      {showRepairForm ? 'Cancel' : '+ New Repair Request'}
                    </button>
                  </div>

                  {showRepairForm && (
                    <div className="bg-slate-800/50 backdrop-blur-sm rounded-2xl p-6 border border-slate-700 mb-6">
                      <h3 className="text-xl font-semibold mb-4">Submit Repair Request</h3>
                      <form onSubmit={async (e) => {
                        e.preventDefault();
                        setRepairLoading(true);
                        setRepairError('');

                        try {
                          if (!repairForm.yacht_id || !user) {
                            throw new Error('Please select a yacht');
                          }

                          let fileUrl = null;
                          let fileName = null;

                          if (repairForm.file) {
                            const fileExt = repairForm.file.name.split('.').pop();
                            const filePath = `${repairForm.yacht_id}/${Date.now()}.${fileExt}`;
                            fileName = repairForm.file.name;

                            const { data: uploadData, error: uploadError } = await supabase.storage
                              .from('repair-files')
                              .upload(filePath, repairForm.file);

                            if (uploadError) throw uploadError;

                            const { data: urlData } = supabase.storage
                              .from('repair-files')
                              .getPublicUrl(filePath);

                            fileUrl = urlData.publicUrl;
                          }

                          const { error: insertError } = await supabase.from('repair_requests').insert({
                            yacht_id: repairForm.yacht_id,
                            submitted_by: user.id,
                            title: repairForm.title,
                            description: repairForm.description,
                            file_url: fileUrl,
                            file_name: fileName,
                            status: 'pending'
                          });

                          if (insertError) throw insertError;

                          const selectedYacht = allYachts.find(y => y.id === repairForm.yacht_id);
                          if (selectedYacht) {
                            const userName = userProfile?.first_name && userProfile?.last_name
                              ? `${userProfile.first_name} ${userProfile.last_name}`
                              : userProfile?.email || 'Unknown';
                            await logYachtActivity(
                              selectedYacht.id,
                              selectedYacht.name,
                              `Repair request submitted: "${repairForm.title}"`,
                              user?.id,
                              userName
                            );
                          }

                          const { data: managers, error: managersError } = await supabase
                            .from('user_profiles')
                            .select('user_id, first_name, last_name')
                            .eq('yacht_id', repairForm.yacht_id)
                            .eq('role', 'manager');

                          if (managersError) throw managersError;

                          if (managers && managers.length > 0) {
                            try {
                              const { data: { session } } = await supabase.auth.getSession();

                              const apiUrl = `${import.meta.env.VITE_SUPABASE_URL}/functions/v1/send-repair-notification`;

                              await fetch(apiUrl, {
                                method: 'POST',
                                headers: {
                                  'Authorization': `Bearer ${session?.access_token}`,
                                  'Content-Type': 'application/json',
                                },
                                body: JSON.stringify({
                                  managerEmails: managers.map(m => `${m.first_name} ${m.last_name}`),
                                  repairTitle: repairForm.title,
                                  yachtName: selectedYacht?.name || 'Unknown Yacht',
                                  submitterName: userProfile?.first_name ? `${userProfile.first_name} ${userProfile.last_name || ''}`.trim() : 'Unknown'
                                })
                              });
                            } catch (emailError) {
                              console.error('Failed to send email notifications:', emailError);
                            }
                          }

                          setRepairSuccess(true);
                          setRepairForm({
                            yacht_id: '',
                            title: '',
                            description: '',
                            file: null
                          });
                          setShowRepairForm(false);
                          await loadRepairRequests();

                          setTimeout(() => setRepairSuccess(false), 3000);
                        } catch (err: any) {
                          setRepairError(err.message || 'Failed to submit repair request');
                        } finally {
                          setRepairLoading(false);
                        }
                      }} className="space-y-4">
                        <div>
                          <label className="block text-sm font-medium mb-2">Yacht Name *</label>
                          <select
                            required
                            value={repairForm.yacht_id}
                            onChange={(e) => setRepairForm({...repairForm, yacht_id: e.target.value})}
                            className="w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-3 focus:outline-none focus:border-orange-500"
                          >
                            <option value="">Select a yacht</option>
                            {allYachts.map((yacht) => (
                              <option key={yacht.id} value={yacht.id}>
                                {yacht.name}
                              </option>
                            ))}
                          </select>
                        </div>

                        <div>
                          <label className="block text-sm font-medium mb-2">Repair Title *</label>
                          <input
                            type="text"
                            required
                            value={repairForm.title}
                            onChange={(e) => setRepairForm({...repairForm, title: e.target.value})}
                            className="w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-3 focus:outline-none focus:border-orange-500"
                            placeholder="Brief description of repair needed"
                          />
                        </div>

                        <div>
                          <label className="block text-sm font-medium mb-2">Description</label>
                          <textarea
                            value={repairForm.description}
                            onChange={(e) => setRepairForm({...repairForm, description: e.target.value})}
                            className="w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-3 focus:outline-none focus:border-orange-500 min-h-[100px]"
                            placeholder="Detailed description of the repair..."
                          />
                        </div>

                        <div>
                          <label className="block text-sm font-medium mb-2">Upload File</label>
                          <input
                            type="file"
                            onChange={(e) => {
                              const file = e.target.files?.[0] || null;
                              setRepairForm({...repairForm, file});
                            }}
                            className="w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-3 focus:outline-none focus:border-orange-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:bg-orange-500 file:text-white file:cursor-pointer hover:file:bg-orange-600"
                          />
                          {repairForm.file && (
                            <p className="text-sm text-slate-400 mt-2">Selected: {repairForm.file.name}</p>
                          )}
                        </div>

                        {repairError && (
                          <div className="bg-red-500/10 border border-red-500 text-red-500 px-4 py-3 rounded-lg text-sm">
                            {repairError}
                          </div>
                        )}

                        <button
                          type="submit"
                          disabled={repairLoading}
                          className="w-full bg-orange-500 hover:bg-orange-600 text-white font-semibold py-4 rounded-lg transition-all duration-300 shadow-lg disabled:opacity-50 disabled:cursor-not-allowed"
                        >
                          {repairLoading ? 'Submitting Request...' : 'Submit Repair Request'}
                        </button>
                      </form>
                    </div>
                  )}

                  {repairSuccess && (
                    <div className="bg-green-500/10 border border-green-500 text-green-500 px-4 py-3 rounded-lg text-sm mb-6">
                      Repair request submitted successfully! Managers have been notified.
                    </div>
                  )}

                  <div className="mt-8">
                    <h3 className="text-xl font-semibold mb-4">All Repair Requests</h3>

                    {repairRequests.length === 0 ? (
                      <div className="bg-slate-800/50 backdrop-blur-sm rounded-2xl p-8 border border-slate-700 text-center">
                        <p className="text-slate-400">No repair requests yet</p>
                      </div>
                    ) : (
                      <div className="space-y-4">
                        {repairRequests.map((request: any) => (
                          <div key={request.id} className="bg-slate-800/50 backdrop-blur-sm rounded-2xl p-6 border border-slate-700">
                            <div className="flex items-start justify-between mb-4">
                              <div className="flex-1">
                                <div className="flex items-center gap-3 mb-2">
                                  <h4 className="text-lg font-semibold">{request.title}</h4>
                                  {request.status === 'pending' && (
                                    <span className="bg-yellow-500/20 text-yellow-500 px-3 py-1 rounded-full text-xs font-semibold">
                                      Pending
                                    </span>
                                  )}
                                  {request.status === 'approved' && (
                                    <span className="bg-green-500/20 text-green-500 px-3 py-1 rounded-full text-xs font-semibold">
                                      ✓ Approved
                                    </span>
                                  )}
                                  {request.status === 'rejected' && (
                                    <span className="bg-red-500/20 text-red-500 px-3 py-1 rounded-full text-xs font-semibold">
                                      ✗ Denied
                                    </span>
                                  )}
                                  {request.status === 'completed' && (
                                    <span className="bg-blue-500/20 text-blue-500 px-3 py-1 rounded-full text-xs font-semibold">
                                      Completed
                                    </span>
                                  )}
                                </div>
                                <p className="text-slate-400 text-sm mb-1">
                                  Yacht: <span className="text-white">{request.yachts?.name || 'Unknown'}</span>
                                </p>
                                {request.description && (
                                  <p className="text-slate-400 text-sm mb-2">{request.description}</p>
                                )}
                                {request.file_url && (
                                  <a
                                    href={request.file_url}
                                    target="_blank"
                                    rel="noopener noreferrer"
                                    className="text-orange-500 hover:text-orange-400 text-sm inline-flex items-center gap-1"
                                  >
                                    📎 {request.file_name || 'View File'}
                                  </a>
                                )}
                                <p className="text-slate-500 text-xs mt-2">
                                  Submitted: {new Date(request.created_at).toLocaleDateString()} at {new Date(request.created_at).toLocaleTimeString()}
                                </p>
                                {request.approval_notes && (
                                  <div className="mt-3 bg-slate-900/50 p-3 rounded-lg">
                                    <p className="text-sm text-slate-300">
                                      <span className="font-semibold">Note:</span> {request.approval_notes}
                                    </p>
                                  </div>
                                )}
                              </div>

                              {userProfile?.role === 'manager' && request.status === 'pending' && (
                                <div className="flex gap-2 ml-4">
                                  <button
                                    onClick={async () => {
                                      const notes = prompt('Add approval notes (optional):');
                                      await handleRepairApproval(request.id, 'approved', notes || undefined);
                                    }}
                                    className="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg text-sm font-semibold transition-all"
                                  >
                                    ✓ Approve
                                  </button>
                                  <button
                                    onClick={async () => {
                                      const notes = prompt('Add denial reason (optional):');
                                      await handleRepairApproval(request.id, 'rejected', notes || undefined);
                                    }}
                                    className="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg text-sm font-semibold transition-all"
                                  >
                                    ✗ Deny
                                  </button>
                                </div>
                              )}
                            </div>
                          </div>
                        ))}
                      </div>
                    )}
                  </div>
                </>
              ) : adminView === 'ownerchat' ? (
                <>
                  <button
                    onClick={() => setAdminView('menu')}
                    className="flex items-center gap-2 text-slate-400 hover:text-purple-500 transition-colors mb-4"
                  >
                    <span>← Back to Admin Menu</span>
                  </button>

                  <div className="flex items-center gap-3 mb-6">
                    <MessageCircle className="w-8 h-8 text-purple-500" />
                    <div>
                      <h2 className="text-2xl font-bold">Owner Chat</h2>
                      <p className="text-slate-400">Connect with all owners of {yacht?.name}</p>
                    </div>
                  </div>

                  <div className="bg-slate-800/50 backdrop-blur-sm rounded-2xl border border-slate-700 overflow-hidden">
                    <div className="h-[500px] overflow-y-auto p-6 space-y-4">
                      {chatMessages.filter((msg: any) =>
                        !msg.message.includes('Check-In Alert:') &&
                        !msg.message.includes('Check-Out Alert:')
                      ).length === 0 ? (
                        <div className="flex items-center justify-center h-full">
                          <p className="text-slate-400">No messages yet. Start the conversation!</p>
                        </div>
                      ) : (
                        chatMessages
                          .filter((msg: any) =>
                            !msg.message.includes('Check-In Alert:') &&
                            !msg.message.includes('Check-Out Alert:')
                          )
                          .map((msg: any) => {
                          const isCurrentUser = msg.user_id === user?.id;
                          const senderName = msg.user_profiles?.first_name && msg.user_profiles?.last_name
                            ? `${msg.user_profiles.first_name} ${msg.user_profiles.last_name}`
                            : 'Unknown User';

                          return (
                            <div
                              key={msg.id}
                              className={`flex ${isCurrentUser ? 'justify-end' : 'justify-start'}`}
                            >
                              <div
                                className={`max-w-[70%] rounded-2xl p-4 ${
                                  isCurrentUser
                                    ? 'bg-purple-500 text-white'
                                    : 'bg-slate-700 text-slate-100'
                                }`}
                              >
                                {!isCurrentUser && (
                                  <p className="text-xs font-semibold mb-1 opacity-80">
                                    {senderName}
                                  </p>
                                )}
                                <p className="text-sm whitespace-pre-wrap break-words">{msg.message}</p>
                                <p className={`text-xs mt-2 ${isCurrentUser ? 'text-purple-200' : 'text-slate-400'}`}>
                                  {new Date(msg.created_at).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}
                                </p>
                              </div>
                            </div>
                          );
                        })
                      )}
                    </div>

                    <div className="border-t border-slate-700 p-4">
                      <div className="flex gap-3">
                        <input
                          type="text"
                          value={newMessage}
                          onChange={(e) => setNewMessage(e.target.value)}
                          onKeyPress={(e) => {
                            if (e.key === 'Enter' && !e.shiftKey) {
                              e.preventDefault();
                              sendChatMessage();
                            }
                          }}
                          placeholder="Type your message..."
                          className="flex-1 bg-slate-900 border border-slate-700 rounded-lg px-4 py-3 focus:outline-none focus:border-purple-500"
                          disabled={chatLoading}
                        />
                        <button
                          onClick={sendChatMessage}
                          disabled={chatLoading || !newMessage.trim()}
                          className="bg-purple-500 hover:bg-purple-600 text-white px-6 py-3 rounded-lg font-semibold transition-all duration-300 shadow-lg disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2"
                        >
                          <Send className="w-5 h-5" />
                          Send
                        </button>
                      </div>
                    </div>
                  </div>

                  {userProfile?.role === 'owner' ? (
                    <div className="mt-4 bg-purple-500/10 border border-purple-500 text-purple-500 px-4 py-3 rounded-lg text-sm">
                      You are connected with all owners of this yacht. Messages are visible to all owners.
                    </div>
                  ) : (
                    <div className="mt-4 bg-amber-500/10 border border-amber-500 text-amber-500 px-4 py-3 rounded-lg text-sm">
                      Note: Only yacht owners can send messages in this chat.
                    </div>
                  )}
                </>
              ) : adminView === 'messages' ? (
                <>
                  <button
                    onClick={() => setAdminView('menu')}
                    className="flex items-center gap-2 text-slate-400 hover:text-cyan-500 transition-colors mb-4"
                  >
                    <span>← Back to Admin Menu</span>
                  </button>

                  <div className="flex items-center gap-3 mb-6">
                    <Mail className="w-8 h-8 text-cyan-500" />
                    <div>
                      <h2 className="text-2xl font-bold">New Messages</h2>
                      <p className="text-slate-400">View all incoming messages from users</p>
                    </div>
                  </div>

                  <div className="space-y-4">
                    {adminNotifications.length === 0 ? (
                      <div className="bg-slate-800/50 backdrop-blur-sm rounded-2xl p-12 border border-slate-700 text-center">
                        <Mail className="w-16 h-16 text-slate-600 mx-auto mb-4" />
                        <p className="text-slate-400 text-lg">No notifications yet</p>
                      </div>
                    ) : (
                      adminNotifications.map((msg: any) => {
                        const senderName = msg.user_profiles?.first_name && msg.user_profiles?.last_name
                          ? `${msg.user_profiles.first_name} ${msg.user_profiles.last_name}`
                          : 'Unknown User';
                        const yachtName = msg.yachts?.name || 'Unknown Yacht';

                        return (
                          <div
                            key={msg.id}
                            className="bg-slate-800/50 backdrop-blur-sm rounded-2xl p-6 border border-slate-700 hover:border-cyan-500 transition-all duration-300"
                          >
                            <div className="flex items-start justify-between mb-4">
                              <div>
                                <div className="flex items-center gap-3 mb-2">
                                  <div className="bg-cyan-500/20 p-2 rounded-lg">
                                    <MessageCircle className="w-5 h-5 text-cyan-500" />
                                  </div>
                                  <div>
                                    <h3 className="font-semibold text-lg">{senderName}</h3>
                                    <p className="text-sm text-slate-400">{yachtName}</p>
                                  </div>
                                </div>
                              </div>
                              <div className="text-right">
                                <p className="text-xs text-slate-400">
                                  {new Date(msg.created_at).toLocaleDateString()}
                                </p>
                                <p className="text-xs text-slate-500">
                                  {new Date(msg.created_at).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}
                                </p>
                              </div>
                            </div>
                            <div className="bg-slate-900/50 rounded-lg p-4">
                              <p className="text-slate-200 whitespace-pre-wrap break-words">{msg.message}</p>
                            </div>
                          </div>
                        );
                      })
                    )}
                  </div>
                </>
              ) : adminView === 'mastercalendar' ? (
                <>
                  <button
                    onClick={() => setAdminView('menu')}
                    className="flex items-center gap-2 text-slate-400 hover:text-teal-500 transition-colors mb-4"
                  >
                    <span>← Back to Admin Menu</span>
                  </button>

                  <div className="bg-slate-800/50 backdrop-blur-sm rounded-2xl border border-slate-700 overflow-hidden">
                    <div className="p-6 border-b border-slate-700">
                      <div className="flex items-center justify-between mb-4">
                        <div className="flex items-center gap-3">
                          <Calendar className="w-8 h-8 text-teal-500" />
                          <h2 className="text-2xl font-bold">Master Calendar</h2>
                        </div>
                        <div className="flex gap-2 bg-slate-800/50 rounded-lg p-1 border border-slate-700">
                          <button
                            onClick={() => setCalendarView('day')}
                            className={`px-4 py-2 rounded-md font-medium transition-all ${
                              calendarView === 'day'
                                ? 'bg-teal-500 text-white'
                                : 'text-slate-400 hover:text-teal-400'
                            }`}
                          >
                            Day
                          </button>
                          <button
                            onClick={() => setCalendarView('week')}
                            className={`px-4 py-2 rounded-md font-medium transition-all ${
                              calendarView === 'week'
                                ? 'bg-teal-500 text-white'
                                : 'text-slate-400 hover:text-teal-400'
                            }`}
                          >
                            Week
                          </button>
                          <button
                            onClick={() => setCalendarView('month')}
                            className={`px-4 py-2 rounded-md font-medium transition-all ${
                              calendarView === 'month'
                                ? 'bg-teal-500 text-white'
                                : 'text-slate-400 hover:text-teal-400'
                            }`}
                          >
                            Month
                          </button>
                        </div>
                      </div>
                      <div className="flex items-center justify-between">
                        <div className="flex items-center gap-3">
                          <button
                            onClick={() => navigateCalendar('prev')}
                            className="p-2 hover:bg-slate-700 rounded-lg transition-colors"
                          >
                            <ChevronLeft className="w-5 h-5" />
                          </button>
                          <button
                            onClick={() => navigateCalendar('next')}
                            className="p-2 hover:bg-slate-700 rounded-lg transition-colors"
                          >
                            <ChevronRight className="w-5 h-5" />
                          </button>
                          <button
                            onClick={goToToday}
                            className="px-4 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg transition-colors font-medium"
                          >
                            Today
                          </button>
                        </div>
                        <h3 className="text-xl font-semibold">{formatCalendarTitle()}</h3>
                      </div>
                    </div>

                    {calendarView === 'month' && (() => {
                      const { daysInMonth, startingDayOfWeek } = getDaysInMonth(currentDate);
                      const days = [];

                      for (let i = 0; i < startingDayOfWeek; i++) {
                        days.push(null);
                      }

                      for (let day = 1; day <= daysInMonth; day++) {
                        days.push(day);
                      }

                      return (
                        <div className="p-4">
                          <div className="grid grid-cols-7 gap-px bg-slate-700 border border-slate-700 rounded-lg overflow-hidden">
                            {['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].map(day => (
                              <div key={day} className="bg-slate-800 p-3 text-center font-semibold text-slate-400 text-sm">
                                {day}
                              </div>
                            ))}
                            {days.map((day, index) => {
                              const date = day ? new Date(currentDate.getFullYear(), currentDate.getMonth(), day) : null;
                              const bookings = date ? getBookingsForDate(date) : [];
                              const isToday = date && date.toDateString() === new Date().toDateString();

                              return (
                                <div
                                  key={index}
                                  className={`bg-slate-900 min-h-[120px] p-2 ${day ? 'hover:bg-slate-800' : ''} transition-colors`}
                                >
                                  {day && (
                                    <>
                                      <div className={`text-sm font-semibold mb-2 ${isToday ? 'bg-teal-500 text-white w-7 h-7 rounded-full flex items-center justify-center' : 'text-slate-300'}`}>
                                        {day}
                                      </div>
                                      <div className="space-y-1">
                                        {bookings.map((booking: any) => {
                                          const startDate = new Date(booking.start_date);
                                          const endDate = new Date(booking.end_date);
                                          startDate.setHours(0, 0, 0, 0);
                                          endDate.setHours(0, 0, 0, 0);
                                          const checkDate = new Date(date!);
                                          checkDate.setHours(0, 0, 0, 0);

                                          const isDeparture = checkDate.getTime() === startDate.getTime();
                                          const isArrival = checkDate.getTime() === endDate.getTime();

                                          return (
                                            <div
                                              key={booking.id}
                                              onClick={() => handleEditBooking(booking)}
                                              className={`text-xs rounded px-2 py-1 cursor-pointer transition-colors truncate ${
                                                isDeparture
                                                  ? 'bg-green-500/20 border border-green-500/30 hover:bg-green-500/30'
                                                  : 'bg-red-500/20 border border-red-500/30 hover:bg-red-500/30'
                                              }`}
                                            >
                                              <div className={`font-medium truncate ${isDeparture ? 'text-green-300' : 'text-red-300'}`}>
                                                {booking.yachts?.name || 'Yacht'}
                                              </div>
                                              <div className="text-slate-400 truncate">{booking.owner_name}</div>
                                              <div className={`text-xs ${isDeparture ? 'text-green-400' : 'text-red-400'}`}>
                                                {isDeparture ? 'Departure' : 'Arrival'}
                                              </div>
                                            </div>
                                          );
                                        })}
                                      </div>
                                    </>
                                  )}
                                </div>
                              );
                            })}
                          </div>
                        </div>
                      );
                    })()}

                    {calendarView === 'week' && (() => {
                      const weekDays = getWeekDays(currentDate);

                      return (
                        <div className="p-4">
                          <div className="grid grid-cols-7 gap-px bg-slate-700 border border-slate-700 rounded-lg overflow-hidden">
                            {weekDays.map((date, index) => {
                              const bookings = getBookingsForDate(date);
                              const isToday = date.toDateString() === new Date().toDateString();
                              const dayName = date.toLocaleDateString('en-US', { weekday: 'short' });
                              const dayNum = date.getDate();

                              return (
                                <div key={index} className="bg-slate-900">
                                  <div className={`p-3 border-b border-slate-700 text-center ${isToday ? 'bg-teal-500/20' : ''}`}>
                                    <div className="text-sm font-semibold text-slate-400">{dayName}</div>
                                    <div className={`text-xl font-bold ${isToday ? 'text-teal-400' : 'text-slate-200'}`}>{dayNum}</div>
                                  </div>
                                  <div className="p-2 min-h-[400px] space-y-2">
                                    {bookings.map((booking: any) => {
                                      const startDate = new Date(booking.start_date);
                                      const endDate = new Date(booking.end_date);
                                      startDate.setHours(0, 0, 0, 0);
                                      endDate.setHours(0, 0, 0, 0);
                                      const checkDate = new Date(date);
                                      checkDate.setHours(0, 0, 0, 0);

                                      const isDeparture = checkDate.getTime() === startDate.getTime();
                                      const isArrival = checkDate.getTime() === endDate.getTime();

                                      return (
                                        <div
                                          key={booking.id}
                                          onClick={() => handleEditBooking(booking)}
                                          className={`rounded-lg p-3 cursor-pointer transition-colors ${
                                            isDeparture
                                              ? 'bg-green-500/20 border border-green-500/30 hover:bg-green-500/30'
                                              : 'bg-red-500/20 border border-red-500/30 hover:bg-red-500/30'
                                          }`}
                                        >
                                          <div className={`font-semibold text-sm mb-1 ${isDeparture ? 'text-green-300' : 'text-red-300'}`}>
                                            {booking.yachts?.name || 'Yacht'}
                                          </div>
                                          <div className="text-xs text-slate-400 mb-2">{booking.owner_name}</div>
                                          <div className={`text-xs font-medium ${isDeparture ? 'text-green-400' : 'text-red-400'}`}>
                                            {isDeparture ? 'Departure' : 'Arrival'}
                                          </div>
                                        </div>
                                      );
                                    })}
                                  </div>
                                </div>
                              );
                            })}
                          </div>
                        </div>
                      );
                    })()}

                    {calendarView === 'day' && (() => {
                      const bookings = getBookingsForDate(currentDate);

                      return (
                        <div className="p-4">
                          <div className="bg-slate-900 border border-slate-700 rounded-lg min-h-[500px]">
                            <div className="p-4 border-b border-slate-700">
                              <div className="text-lg font-semibold text-slate-200">
                                {currentDate.toLocaleDateString('en-US', { weekday: 'long' })}
                              </div>
                            </div>
                            <div className="p-4 space-y-3">
                              {bookings.length === 0 ? (
                                <div className="text-center py-12 text-slate-400">
                                  <Calendar className="w-12 h-12 mx-auto mb-3 text-slate-600" />
                                  <p>No trips scheduled for this day</p>
                                </div>
                              ) : (
                                bookings.map((booking: any) => {
                                  const startDate = new Date(booking.start_date);
                                  const endDate = new Date(booking.end_date);
                                  startDate.setHours(0, 0, 0, 0);
                                  endDate.setHours(0, 0, 0, 0);
                                  const checkDate = new Date(currentDate);
                                  checkDate.setHours(0, 0, 0, 0);

                                  const isDeparture = checkDate.getTime() === startDate.getTime();
                                  const isArrival = checkDate.getTime() === endDate.getTime();

                                  return (
                                    <div
                                      key={booking.id}
                                      onClick={() => handleEditBooking(booking)}
                                      className={`border rounded-lg p-4 cursor-pointer transition-all ${
                                        isDeparture
                                          ? 'bg-green-500/10 border-green-500/50 hover:border-green-500'
                                          : 'bg-red-500/10 border-red-500/50 hover:border-red-500'
                                      }`}
                                    >
                                      <div className="flex items-start justify-between">
                                        <div className="flex-1">
                                          <div className="flex items-center gap-3 mb-3">
                                            <div className={`p-2 rounded-lg ${isDeparture ? 'bg-green-500/20' : 'bg-red-500/20'}`}>
                                              <Ship className={`w-5 h-5 ${isDeparture ? 'text-green-500' : 'text-red-500'}`} />
                                            </div>
                                            <div>
                                              <h4 className="font-bold text-lg">{booking.yachts?.name || 'Yacht'}</h4>
                                              <p className="text-sm text-slate-400">{booking.owner_name}</p>
                                              <div className={`text-xs font-medium mt-1 ${isDeparture ? 'text-green-400' : 'text-red-400'}`}>
                                                {isDeparture ? 'Departure' : 'Arrival'}
                                              </div>
                                            </div>
                                          </div>
                                          <div className="grid grid-cols-2 gap-3 mb-3">
                                            <div className="bg-slate-900/50 rounded p-2">
                                              <p className="text-xs text-slate-400 mb-1">Departure</p>
                                              <p className="text-sm font-medium">{formatDate(booking.start_date)}</p>
                                              <p className="text-xs text-slate-300">{formatTime(booking.start_date)}</p>
                                            </div>
                                            <div className="bg-slate-900/50 rounded p-2">
                                              <p className="text-xs text-slate-400 mb-1">Return</p>
                                              <p className="text-sm font-medium">{formatDate(booking.end_date)}</p>
                                              <p className="text-xs text-slate-300">{formatTime(booking.end_date)}</p>
                                            </div>
                                          </div>
                                          <div className="flex gap-2">
                                            {booking.checked_in && (
                                              <div className="flex items-center gap-1 px-2 py-1 bg-green-500/20 border border-green-500/30 rounded text-xs text-green-400">
                                                <CheckCircle className="w-3 h-3" />
                                                <span>Checked In</span>
                                              </div>
                                            )}
                                            {booking.checked_out && (
                                              <div className="flex items-center gap-1 px-2 py-1 bg-blue-500/20 border border-blue-500/30 rounded text-xs text-blue-400">
                                                <CheckCircle className="w-3 h-3" />
                                                <span>Checked Out</span>
                                              </div>
                                            )}
                                          </div>
                                        </div>
                                      </div>
                                    </div>
                                  );
                                })
                              )}
                            </div>
                          </div>
                        </div>
                      );
                    })()}

                    {editingBooking && (
                      <div className="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 z-50">
                        <div className="bg-slate-800 rounded-2xl border border-slate-700 p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto">
                          <h3 className="text-xl font-bold mb-4">Edit Trip</h3>
                          <form onSubmit={handleUpdateBooking} className="space-y-4">
                            <div>
                              <label className="block text-sm font-medium mb-2">Owner Name</label>
                              <input
                                type="text"
                                value={editBookingForm.owner_name}
                                onChange={(e) => setEditBookingForm({ ...editBookingForm, owner_name: e.target.value })}
                                className="w-full px-4 py-2 bg-slate-900/50 border border-slate-600 rounded-lg focus:outline-none focus:border-amber-500 text-white"
                                required
                              />
                            </div>
                            <div>
                              <label className="block text-sm font-medium mb-2">Contact Info</label>
                              <input
                                type="text"
                                value={editBookingForm.owner_contact}
                                onChange={(e) => setEditBookingForm({ ...editBookingForm, owner_contact: e.target.value })}
                                className="w-full px-4 py-2 bg-slate-900/50 border border-slate-600 rounded-lg focus:outline-none focus:border-amber-500 text-white"
                                required
                              />
                            </div>
                            <div className="grid grid-cols-2 gap-4">
                              <div>
                                <label className="block text-sm font-medium mb-2">Departure Date</label>
                                <input
                                  type="date"
                                  value={editBookingForm.start_date}
                                  onChange={(e) => setEditBookingForm({ ...editBookingForm, start_date: e.target.value })}
                                  className="w-full px-4 py-2 bg-slate-900/50 border border-slate-600 rounded-lg focus:outline-none focus:border-amber-500 text-white"
                                  required
                                />
                              </div>
                              <div>
                                <label className="block text-sm font-medium mb-2">Departure Time</label>
                                <input
                                  type="time"
                                  value={editBookingForm.departure_time}
                                  onChange={(e) => setEditBookingForm({ ...editBookingForm, departure_time: e.target.value })}
                                  className="w-full px-4 py-2 bg-slate-900/50 border border-slate-600 rounded-lg focus:outline-none focus:border-amber-500 text-white"
                                  required
                                />
                              </div>
                            </div>
                            <div className="grid grid-cols-2 gap-4">
                              <div>
                                <label className="block text-sm font-medium mb-2">Return Date</label>
                                <input
                                  type="date"
                                  value={editBookingForm.end_date}
                                  onChange={(e) => setEditBookingForm({ ...editBookingForm, end_date: e.target.value })}
                                  className="w-full px-4 py-2 bg-slate-900/50 border border-slate-600 rounded-lg focus:outline-none focus:border-amber-500 text-white"
                                  required
                                />
                              </div>
                              <div>
                                <label className="block text-sm font-medium mb-2">Return Time</label>
                                <input
                                  type="time"
                                  value={editBookingForm.arrival_time}
                                  onChange={(e) => setEditBookingForm({ ...editBookingForm, arrival_time: e.target.value })}
                                  className="w-full px-4 py-2 bg-slate-900/50 border border-slate-600 rounded-lg focus:outline-none focus:border-amber-500 text-white"
                                  required
                                />
                              </div>
                            </div>
                            {editBookingError && (
                              <div className="bg-red-500/10 border border-red-500 text-red-500 px-4 py-3 rounded-lg text-sm">
                                {editBookingError}
                              </div>
                            )}
                            <div className="flex gap-3">
                              <button
                                type="submit"
                                disabled={editBookingLoading}
                                className="flex-1 bg-amber-500 hover:bg-amber-600 text-slate-900 font-semibold py-3 rounded-lg transition-colors disabled:opacity-50"
                              >
                                {editBookingLoading ? 'Saving...' : 'Save Changes'}
                              </button>
                              <button
                                type="button"
                                onClick={() => setEditingBooking(null)}
                                className="px-6 bg-slate-700 hover:bg-slate-600 text-white font-semibold py-3 rounded-lg transition-colors"
                              >
                                Cancel
                              </button>
                            </div>
                          </form>
                        </div>
                      </div>
                    )}
                  </div>
                </>
              ) : null}
            </div>
          )}
        </div>
      </div>
    </div>
  );
};
